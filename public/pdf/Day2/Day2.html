<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R and R-markdown Basics</title>
    <meta charset="utf-8" />
    <meta name="author" content="Bastola" />
    <meta name="date" content="2022-01-07" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.20/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link href="libs/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.5/countdown.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, top, my-title, title-slide

# R and R-markdown Basics
## <br/> STAT 220
### Bastola
### 2022-01-07

---





&lt;style type="text/css"&gt;
.red { color: red; }

&lt;/style&gt;

# Replicability vs. Reproducibility

- Scientific findings should be **replicatable**

    * Asha repeats Bob's lab experiment and gets different data but makes the same conclusions as Bob
    
--

- Statistical findings should be **reproducible**

    * Asha takes Bob's data and gets the exact same statistical results as Bob
--

- Statistical findings should be *easily* **reproducible**

    * Asha only needs to hit one button to reproduce Bob's results.
    
    * Asha only needs to hit one button to reproduce Bob's analysis on a *new data set*


---


# Reproducible data science


### Short-term impact

- Are the tables and figures reproducible from the code and data?

- Does the code work as intended?

- In addition to what was done, is it clear **why** it was done? 
(e.g., how were parameter settings chosen?)

--

### Long-term impact

- Can the code be used for other data?

- Can you extend the code to do other things?

---


# Making your work reproducible

* You need a scriptable program (e.g. R, Python)

    * forces you to record the linear sequence of events in an analysis
    
    * avoid point-n-click!
    
    * avoid any "by hand" actions (e.g. data cleaning in Excel)

--

.red[But scriptable doesn't always mean reproducible!!]

--

* You should make your workflow  transparent and easily followed, `\(\rightarrow\)` R Markdown

    * meaningful file and variable names
    
    * don't overly complicate code, use packages when only when needed (the fewer dependencies the better)
    
    * only relevant code included
    
    * **written description of your analysis process and results alongside your code**


---
background-image: url(https://github.com/yihui/xaringan/releases/download/v0.0.2/karl-moustache.jpg)
background-size: cover
class: center, bottom, inverse

# Karl Broman’s [Steps toward Reproducible Research](https://www.biostat.wisc.edu/~kbroman/presentations/repro_research_JSM2016_withnotes.pdf)

---


# Reproducibility using R markdown

- Karl Broman paraphrasing Mark Holder: 

    + **Your closest collaborator is you six months ago, but you don’t reply to emails.**
    
    + You need to document your workflow for both yourself and current/future collaborators
    


- R Markdown is a literate programming language that integrates R code, results and write-up.

    + literate = it is readable and easy to learn


 &lt;img src="http://r4ds.had.co.nz/images/RMarkdownFlow.png" width=600&gt;

---


# Assignment-0 Recap




<div id="htmlwidget-e89a04ccb155ba075512" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e89a04ccb155ba075512">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880,1880],["F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F"],["Mary","Anna","Emma","Elizabeth","Minnie","Margaret","Ida","Alice","Bertha","Sarah","Annie","Clara","Ella","Florence","Cora","Martha","Laura","Nellie","Grace","Carrie","Maude","Mabel","Bessie","Jennie"],[7065,2604,2003,1939,1746,1578,1472,1414,1320,1288,1258,1226,1156,1063,1045,1040,1012,995,982,949,858,808,796,793],[0.07238359,0.02667896,0.02052149,0.01986579,0.01788843,0.0161672,0.01508119,0.01448696,0.0135239,0.01319605,0.01288868,0.01256083,0.01184366,0.01089084,0.01070642,0.01065519,0.01036832,0.01019415,0.01006096,0.00972286,0.00879053,0.00827826,0.00815532,0.00812458]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>sex<\/th>\n      <th>name<\/th>\n      <th>n<\/th>\n      <th>prop<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"columnDefs":[{"className":"dt-right","targets":[1,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


--


```r
dim(babynames)
# [1] 1924665       5
```


---

# Communication is important!

![](Day2_files/figure-html/trend-1.svg)&lt;!-- --&gt;

--

.red[The overall trend of baby name `John` has been on a steady decline over the years.]

---

# Basic anatomy of R-markdown


1. The **metadata**

1. The **text** 

1. The **code**

1. The **output**


---

# Let's look at the source anatomy 

Please git clone this repository to your local folder.

![](images/01-githubpage.png)

<div class="countdown" id="timer_61d8d6f6" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---


# Metadata and output types

.pull-left[

**YAML** (yet another markup language)

-  data serialization language that is often used for writing configuration files.


Basic recipe: 
```yaml
---
key: value
---
```


Example:

```yaml
---
title: My title
output:
  github_document
    toc: true
    theme: flatly
---
```

]

--

.pull-right[

**Output types**

- html_document (can’t view in GitHub repo)
- pdf_document (need MikTex or MacTex installed)
- github_document (creates a .md Markdown doc, viewable on
GitHub)
- ioslides_presentation, beamer_presentation


```yaml
---
title: "Baby Name Trends"
output: github_document
---
```

```yaml
---
title: "Baby Name Trends"
output: github_document
params: 
  attribute: value
---
```

]


---


# Parameters

```yaml
---
title: "Baby Name Trends"
output: html_document
params: 
  name:
  from:
  to:
---
```


To Do:

- Change the parameters and output types!!
- Try 'Knit with Parameters'

<div class="countdown" id="timer_61d8d59b" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">06</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---

# Text

Use markdown to format the text

[10 minute tutorial](https://commonmark.org/help/tutorial/)

![](images/01-rmarkdown_tutorial.png)



---


# Text

- Simple  rules for 

--
    * section headers (`#`,`##`,etc)
--
    * lists (need ~2 tabs to create sublists)
--
    * formatting (bold `**`, italics `*`)
--
    * tables
--
    * R syntax (use backward tick ` ` `)
--
    * web links `[linked text](url)`
--
    * latex math equations `\(\beta_1 + \beta_2\)`
--
    * in HTML docs, you can use HTML commands (in pdf, latex commands)
   
For further help, look at [R Markdown Cheatsheet](https://deepbas.io/courses/stat220/cheatsheets/)
    
---


# Code chunks

Code goes in **chunks**, defined by three backticks



````
```{r}

filtered_names &lt;- babynames %&gt;% filter(name=="Amiee", year &lt; max(year), year &gt; min(year))

ggplot(data=filtered_names, aes(x=year, y=prop)) + 
  geom_line(aes(colour=sex)) + 
  xlab('Year') + 
  ylab('Prop. of Babies Named Aimee')

```
````
---




#  Adding/running chunks

Let's

1. Add chunks with button or:

   Command (or Cmd) `⌘` + Option (or Alt) `⌥` +  `i` (Mac)
  
   Ctrl + Alt + `i` (Windows/Linux)
   
1. Run chunks by:

   Run current chunk button (interactive)
   
   Knit button / run all chunks
   
---


# Inline code

.left-wide[

How many babies were born with name 'Aimee'?

``` `r  sum(filtered_names$n)` ```

There are a total of
53228 babies.

]
--

.right-narrow[

In what year were there highest number of babies born with the name `Aimee`?

``` `r  filtered_names$year[which.max(filtered_names$prop)]` ```

`Aimee` name was the most popular in 
1973.

]

---


# Chunk options

.pull-left[
````
```{r}
glimpse(filtered_names)
```
````
]


.pull-right[

```r
dplyr::glimpse(filtered_names)
## Rows: 148
## Columns: 5
## $ year &lt;dbl&gt; 1881, 1882, 1883, 1884, 1885, 1886, 1887, 1888, 1889, 1890, 1891,…
## $ sex  &lt;chr&gt; "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", …
## $ name &lt;chr&gt; "Aimee", "Aimee", "Aimee", "Aimee", "Aimee", "Aimee", "Aimee", "A…
## $ n    &lt;int&gt; 11, 13, 11, 15, 17, 17, 18, 12, 16, 18, 14, 15, 17, 13, 13, 23, 1…
## $ prop &lt;dbl&gt; 0.00011127, 0.00011236, 0.00009162, 0.00010902, 0.00011976, 0.000…
```
]

---
# echo


````
```{r echo=FALSE}
glimpse(filtered_names)
```
````




```
## Rows: 148
## Columns: 5
## $ year &lt;dbl&gt; 1881, 1882, 1883, 1884, 1885, 1886, 1887, 1888, 1889, 1890, 1891,…
## $ sex  &lt;chr&gt; "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", …
## $ name &lt;chr&gt; "Aimee", "Aimee", "Aimee", "Aimee", "Aimee", "Aimee", "Aimee", "A…
## $ n    &lt;int&gt; 11, 13, 11, 15, 17, 17, 18, 12, 16, 18, 14, 15, 17, 13, 13, 23, 1…
## $ prop &lt;dbl&gt; 0.00011127, 0.00011236, 0.00009162, 0.00010902, 0.00011976, 0.000…
```


---

# eval

.pull-left[
````
```{r eval=FALSE}
glimpse(filtered_names)
```
````
]

.pull-right[

```r
glimpse(filtered_names)
```
]

---
# include
.pull-left[
````
```{r include=FALSE}
glimpse(filtered_names)
```
````
]
.pull-right[

]

---

# results
.pull-left[
.code108[
````
```{r echo=TRUE, results='hide'}
glimpse(filtered_names)
```
````
]
]

.pull-right[
.code108[

```r
glimpse(filtered_names)
```
]
]


---
# Chunk option take-aways
+ Place between curly braces&lt;br&gt;`{r option=value}`

+ Multiple options separated by commas&lt;br&gt;`{r option1=value, option2=value}`

+ Careful! The `r` part is the **code engine** (other engines possible)

---
# Chunk labels

.code100[
````
```{r peek, echo=FALSE, results='hide'}
glimpse(filtered_names)
```
````

]

+ Place between curly braces&lt;br&gt;`{r label}`
+ Separate options with commas&lt;br&gt;`{r label, option1=value}`
+ Careful! Don't duplicate labels

.code100[
````
```{r peek}
head(filtered_names)
```
````
]
.code100[
```
Error in parse_block(g[-1], g[1], params.src) : 
  duplicate label 'peek'
Calls: &lt;Anonymous&gt; ... process_file -&gt; split_file -&gt; lapply -&gt; FUN -&gt; parse_block
Execution halted
```
]

???
how can we make it easier on ourselves to explore the code in here?
show how to add chunk labels and view in IDE interactively

---

# The setup chunk
.pull-left[
````
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,   
  comment = "#&gt;", 
  out.width = "100%" 
)
```
````
]
.pull-right[
+ A special chunk label: `setup`

+ Typically the first

+ All following chunks will use these options (i.e., sets global chunk options)

+ **Tip**: set `include=FALSE`

+ You can (and should) use individual chunk options too
]

---


#  Exercise

Customize this report

1. Label the code chunk with your plot in it.

1. Add your setup chunk.

1. Add `fig.path = "figs/"` as a knitr code chunk option for a single plot. What happened? What happens if you don't include the forwardslash?

1. Knit and behold

1. Add it to a global setup chunk instead

<div class="countdown" id="timer_61d8d4e9" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Acknowledgments

Parts of these slides were adapted from previous works of Adam Loy and Katie St. Clair.



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
