---
title: "Data wrangling with **dplyr**"
subtitle: "<br/> STAT 220"
author: "Bastola"
date: "`r format(Sys.Date(), ' %B %d %Y')`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    nature:
      ratio: '16:9'
      titleSlideClass: ["center", "top", "my-title"]
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
      countdown: 60000
---

<style type="text/css">

.hljs-github .hljs {
    background: #e5e5e5;
}

.inline-c, remark-inline-code {
   background: #e5e5e5;
   border-radius: 3px;
   padding: 4px;
   font-family: 'Source Code Pro', 'Lucida Console', Monaco, monospace;
}

.yellow-h{
   background: #ffff88;
}

.out-t, remark-inline-code {
   background: #9fff9f;
   border-radius: 3px;
   padding: 4px;
   
}

.pull-left-c {
    float: left;
    width: 58%;
    
}

.pull-right-c {
    float: right;
    width: 38%;
    
}

.large {
    font-size: 200%
    
}

.medium {
    font-size: 75%
    
}

.small {
    font-size: 50%
    }

.action {
    background-color: #f2eecb;
  
}

</style>

```{css, echo = FALSE}
.red{ color: red;}
.remark-code, .remark-inline-code {
    font-family: 'Fira Mono', 'Source Code Pro', monospace;}
.remark-slide-scaler {
    overflow-y: auto;}
.remark-slide-content {
  font-size: 28px;
  padding: 20px 80px 20px 80px;
}
.remark-code, .remark-inline-code {
  background: #f0f0f0;
}
.remark-code {
  font-size: 24px;
}
.huge .remark-code { /*Change made here*/
  font-size: 200% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 50% !important;
}
.remark-slide-number {
    display: none;
}

```




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      dev = 'svg',
                      collapse = TRUE, 
                      comment=NA, 
                      warning = FALSE,
                      message = FALSE,
                      fig.height = 4, fig.width = 6, fig.align='center')



library(dplyr)
library(ggplot2)
library(countdown)
library(ggthemes)
library(tidyverse)
library(stringr)
library(xaringanExtra)
xaringanExtra::use_panelset()

library(knitr)
library(kableExtra)
library(fontawesome)
```


---

class: inverse, middle

.large[Data wrangling]

.blockquote[the process of cleaning and unifying messy and complex data sets for easy access and analysis]

.footnote[Source: datawatch.com]

---

# Essential data wrangling tasks


1. Extract a subset of columns

2. Extract a subset of rows

3. Order the rows from smallest to largest (or largest to smallest)

4. Compute a table of summary statistics, perhaps by group

5. Create new columns

---

background-image: url("images/dplyr.png")
background-position: 100% 100% 
background-size: 100% 100%

---
# The Five Verbs

The creater of `dplyr`, [Hadley Wickham](https://en.wikipedia.org/wiki/Hadley_Wickham), argues that most of the operations on a data table can be achieved with

- *select()*
- *filter()*
- *mutate()*
- *arrange()*
- *summarize()*

---

# Babynames Dataset

- Names of babies born in the U.S. between 1960 and 2008
- Data grouped by states
- Source: Social Security Administration

--

```{r}
babynames <- read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/baby-names-by-state.csv")
glimpse(babynames)
```

---

```{r echo=FALSE, fig.height=3, fig.width = 6, out.width=900}
john <- filter(babynames, name == "John", sex == "boy")
john_plot <- ggplot(john, aes(x = year, y = number)) +
  geom_line() +
  scale_x_continuous(name = NULL, breaks = seq(1960, 2008, by = 4)) +
  labs(y = "Proportion of babies",
       title = "Proportion of boys with the name John")

ggsave(plot = john_plot, filename = "images/john_plot.png", height = 3, width = 6)
```

---

# Find a subset of the columns using *select()*:

```{r}
babynames %>%
  select(year, name, number) %>%
  head()
```


---

# Find a subset of the rows using *filter()*:

```{r}
babynames %>%
  filter(name == "Bella") %>%
  head()
```


---

# Do both and assign to a new object


```{r}
bella <- babynames %>%
  filter(name == "Bella") %>%
  select(year, name, sex, number)

```

--

.pull-left[

```{r}
head(bella)
```

]

.pull-right[
```{r}
dim(bella)
class(bella)
```

]


---

# *summarize()*

```{r}
babynames %>% 
  filter(name == "Bella", sex == "girl") %>% 
  summarise(total = sum(number), max = max(number), mean = mean(number))

```

---

class: action

# Your Turn 1

Use the code chunk below to compute three statistics:

1. the total number of children who ever had your name
1. the maximum number of children given your name in a single year
1. the mean number of children given your name per year 

`r countdown(minutes = 3, seconds = 00, left = 0, color_background = "inherit")`

---

# Using *group_by()*

```{r}
babynames %>% 
  group_by(year, sex)
```

---

# Using *group_by()* along with *summarize()*

```{r}
# remove rows containing missing values 
babynames <- babynames %>% drop_na() 
```

--

```{r}
babynames %>%
  group_by(year) %>% 
  summarise(total = sum(number))

```

---

# *mutate()*

```{r}
babynames <- babynames %>%
  group_by(year) %>%
  mutate(year_total = sum(number))
head(babynames)
```

---

# add more columns

```{r}
babynames <- babynames %>%
  group_by(year) %>%
  mutate(prop = number / year_total) 
head(babynames)
```

---

# Most common names in 1990?

```{r}
babynames %>%
  filter(year == 1990) %>%
  arrange(desc(prop))
```

---

# *top_n()*: Most common name in each year.

```{r}
babynames %>%
  group_by(year) %>%
  top_n(1, prop)

```
---

class: action

# Your Turn 2

Find the year your first name is most common. If you name is not on the dataset, pick any other popular name.

```{r}
# Filter for the names Steven, Thomas, and Matthew 
selected_names <- babynames %>%
  filter(name %in% c("Dan", "Eli"), sex == "boy")

# Plot the names using a different color for each name
ggplot(selected_names, aes(x = year, y = number, color = name)) +
  geom_line()

```


`r countdown(minutes = 3, seconds = 00, left = 0, color_background = "inherit")`


---
class: center, middle, inverse

## Acknowledgement: some of the slides are based on previous works of Adam Loy and Katie St. Clair.

