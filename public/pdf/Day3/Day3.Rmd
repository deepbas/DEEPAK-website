---
title: "Data Objects and Basics Data Visualization"
subtitle: "<br/> STAT 220"
author: "Bastola"
date: "`r format(Sys.Date(), ' %B %d %Y')`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, "custom.css"]
    lib_dir: libs
    nature:
      ratio: '16:9'
      titleSlideClass: ["center", "top", "my-title"]
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
---

<style type="text/css">

.hljs-github .hljs {
    background: #e5e5e5;
}

.inline-c, remark-inline-code {
   background: #e5e5e5;
   border-radius: 3px;
   padding: 4px;
   font-family: 'Source Code Pro', 'Lucida Console', Monaco, monospace;
}

.yellow-h{
   background: #ffff88;
}

.out-t, remark-inline-code {
   background: #9fff9f;
   border-radius: 3px;
   padding: 4px;
   
}

.pull-left-c {
    float: left;
    width: 58%;
    
}

.pull-right-c {
    float: right;
    width: 38%;
    
}

.medium {
    font-size: 75%
    
}

.small {
    font-size: 50%
    }

.action {
    background-color: #f2eecb;
  
}

</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      dev = 'svg',
                      collapse = TRUE)

library(dplyr)
library(ggplot2)
library(countdown)
library(ggthemes)
library(tidyverse)

```

```{css, echo = FALSE}
.red{ color: red;}
.remark-code, .remark-inline-code {
    font-family: 'Fira Mono', 'Source Code Pro', monospace;
}

```


# Objects in R

- Anything created or imported into R is called an .yellow-h[object]
<br>
--
  - vectors, data frames, matrices, lists, functions, lm, ...

--

- We usually store objects in the workspace using the assignment **operator** '<-'


```{r,  tidy=FALSE}
x <- c(8,2,1,3)
ls()
```

--

- The `=` operator also does assignment, but it is mainly used for argument specification inside a function.

--

```{r,  tidy=FALSE}
y <- rnorm(3, mean = 10, sd = 2)
ls()
```

--

- .red[Please don't use `=` for assignment!!!]


---

# Data structures and types

.pull-left[

- Every object is a **vector** 

- `NULL` = empty object (vector of length 0)

- `typeof()`: tells us about storage of data
    - Logical: TRUE or FALSE 
    - Integer and double
    - Character: string ("") of text
    - List

]    

--

.pull-right[

```{r,  tidy=FALSE}
x <- c(8,2,1,3)
typeof(x)  # type of storage mode 
typeof(c(8L,2L,1L,3L))  # adding L forces integer type
x == 1
typeof(x == 1)
```

]


---

# Data structures and types

.pull-left[

- Every object is a **vector** 

- `NULL` = empty object (vector of length 0)

- `typeof()`: tells us about storage of data
    - Logical: TRUE or FALSE 
    - Integer and double
    - Character: string ("") of text
    - List

`class` further describes the object


]    


.pull-right[

```{r,  tidy=FALSE}
x <- c(8,2,1,3)
typeof(x)  # type of storage mode 
typeof(c(8L,2L,1L,3L))  # adding L forces integer type
x == 1
typeof(x == 1)
```

<br>

```{r, tidy = FALSE}
class(x)   # object class is numeric
```

]

---

# Object Oriented Programming

- In R, commands care about object class and type

--

  - Ex: the default `plot` command wants a vector of data or a formula to form a scatterplot
  
--

```{r, eval=FALSE}
plot(y ~ x, data= mydata) # makes scatterplot if x and y numeric
```

--

- but if you give `plot` a `lm` regression object it will produce a set of diagnostic plots for that regression model.

```{r, eval=FALSE}
my_lm <- lm(y ~ x, data= mydata)  # make a linear model
plot(my_lm)  # makes multiple diagnostic plots
```

--

- In your **Console** window, type `?plot` then hit **tab**. 

> ?plot

    - see `plot`, `plot.acf`, ...

---

# Atomic Vectors and lists

- R uses two types of vectors to store info
    - **atomic vectors**: all entries have the same data type 
    - **lists**: entries can contain other objects that can differ in data type
    
- All vectors have a length

--

```{r, tidy = FALSE}
x    # atomic vector

length(x)
```

--

```{r}

x_list <- list(x, 1, "a")  # list

length(x_list)
```

---

# Atomic Vectors: Matrices

- You can add **attributes**, such as **dimension**, to vectors
- A **matrix** is a 2-dimensional vector containing entries of the same type

--

.pull-left[

```{r}
x_mat <- matrix(x, nrow = 2, byrow = TRUE)
x_mat
attributes(x_mat)
```


```{r}
typeof(x_mat)   # type of entries
class(x_mat)   # info about object
```

]

--
.pull-right[

- or you can bind vectors of the same length to create columns or rows:
```{r}
x_mat2 <- cbind(x, 2*x)
x_mat2
```


]


---

# Lists: Data frames 

- A **data frame** is a list of atomic vectors of the same length, but not necessarily the same data type
- the `babynames` data frame has columns that are `integer` and `character` types

--

```{r}
babynames <- `read.csv`("https://raw.githubusercontent.com/deepbas/statdatasets/main/baby-names-by-state.csv")
class(babynames)
typeof(babynames)
glimpse(babynames)
```

---

# Coercion and the factor class

- Entries in atomic vectors must be the same data type
- R will default to the most complex data type if more than one type is given

--

```{r}
y <- c(1, 2, "a")
```

--

```{r}
typeof(y)
y
```

--

- This example was **implicit coercion**

--

- **Explicit coercion** intentionally forces a data type that is different from the "default" type
```{r}
y <- as.character(c(1,2,3))
```

```{r, tidy = TRUE}
typeof(y)
y
```

---

#  Coercion and the factor class

- Logical values coerced into 0 for `FALSE` and 1 for `TRUE` when applying math functions

```{r}
x <- c(8,2,1,3)
x >= 5  # which entries >= 5?
sum(x >= 5)  # how many >=5 ?
```

- What will `mean` of a logical vector measure?

```{r, eval = FALSE}
mean(x >= 5) 
```

--


```{r, echo=FALSE}
mean(x >= 5) 
```

---

# Data types: factors 

- Factors are a class of data that are stored as **integers**

```{r}
x_fct <- as.factor(c("yes", "no", "no"))

class(x_fct)
typeof(x_fct)
```

--

- The attribute `levels` is a character vector of possible values
    - Values are stored as the integers (1=first `level`, 2=second `level`, etc)
    - Levels are ordered alphabetically/numerically (unless specified otherwise)
    
--

```{r}
str(x_fct)
levels(x_fct)
```
---

# Subsetting: Atomic Vector

- subset with `[]` by referencing index value (from 1 to vector length):

```{r}
x
x[c(4, 2)]  # get 4th and 2nd entries
```

--

- subset by omitting entries
```{r}
x[-c(4, 2)]  # omit 4th and 2nd entries
```

--

- subset with a logical vector
```{r}
x[c(TRUE, FALSE, TRUE, FALSE)]  # get 1st and 3rd entries
```


---

# Subsetting: Matrices

- access entries using subsetting `[row,column]`
```{r}
x_mat2
```

--

```{r}
x_mat2[, 1] # first column
```

--

```{r}
x_mat2[1:2, 1] # first 2 rows of first column
```

--

- .yellow-h[R doesn't always preserve class]:  

```{r}
class(x_mat2[1,])  # one row (or col) is no longer a matrix (1D)
```

---

# Subsetting: Data frames

- you can access entries like a matrix:

```{r}
x_df <- data.frame(x = x, double_x = x*2)
x_df
```

--

```{r}
x_df[, 1]  # first column, all rows
```

--

```{r}
class(x_df[, 1])  # first column is no longer a data frame
```

--

- One column of a data frame is no longer a data frame 

---

# Subsetting: Data frames 

.pull-left[
- or access columns with `$`
```{r}
x_df$x  # get variable x column
```



- you can also use column names to subset:
```{r}
# get 2 rows of Name and Sex
babynames[1:2, c("name", "sex")] 
```

]

--

.pull-right[

- Recall: a **list** is a vector with entries that can be different object types
```{r}
my_list <- list(myVec = x, 
                myDf = x_df, 
                myString = c("hi", "bye"))
my_list
```


]

---

# Subsetting: Lists 

.pull-left[

- Like a data frame, can use the `$` to access **named** objects stored in the list
  - E.g.: `my_list$myDf` return the **data frame** `myDf` 

```{r}
my_list$myDf
class(my_list$myDf)
```

]

--

.pull-right[

- one `[]` operator gives you the object at the given location but preserves the list type
  - `my_list[2]` return a **list** of length one with entry `myDf` 
  
```{r}
my_list[2]
```


```{r}
str(my_list[2])
```

]

---

# Subsetting: Lists 

- the double  `[[]]` operator  gives you the object stored at that location (equivalent to using `$`)
  - `my_list[[2]]` or `my_list[["myDf"]]` return the **data frame** `myDf` 

```{r}
my_list[[2]]
str(my_list[[2]])
```

---
class: action

# Your Turn
Please git clone the repository [02-Data-Objects-Viz](https://github.com/stat220/02-DataObj_Viz_Activity) to your local folder.

````md
`r ''````{r}
babynames <- read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/baby-names-by-state.csv")
x <- c(3,6,9,5,1)
x.mat <- cbind(x, 2*x)
x.df <- data.frame(x=x,double.x=x*2)
my.list <- list(myVec=x, myDf=x.df, myString=c("hi","bye"))

```
````

### Question 1: data types

- What data type is `x`? What data type is `babynames$number`? 
- What data type is `c(x, babynames$year)`?
- What data type is `c(x,NA)`?  What data type is `c(x,"NA")`?


`r countdown(minutes = 3, seconds = 00, top = 1, color_background = "inherit")`



---

class: action

# Your Turn

### Question 2: Subsetting and coercion

- How can we reverse the order of entries in `x`?
- What does `which(x < 5)` equal?
- What does `sum(c(TRUE,FALSE,FALSE,FALSE, TRUE))` equal?
- What does `sum(x[c(TRUE,FALSE,FALSE,FALSE, TRUE)])` equal?
- What does `sum(x < 5)` equal?
- What does `sum(x[x < 5])` equal?
- Why `dim(x.mat[1:2,1])` return `NULL` while `dim(x.mat[1:2,1:2])` returns a dimension?


`r countdown(minutes = 5, seconds = 00, top = 1, color_background = "inherit")`
---
class: action

# Your Turn

### Question 3: Lists

- Using `my.list`, show three ways to write one command that gives the 3rd entry of variable `x` in data frame `myDf`
- What class of object does the command `my.list[3]` return?
- What class of object does the command `my.list[[3]]` return?
- What class of object does the command `unlist(my.list)` return? Why are all the entries `character`s?

`r countdown(minutes = 3, seconds = 00, top = 1, color_background = "inherit")`

--

### Question 4: Data Frames

- What is the total number of babies born in Minnesota with name `Alex`?
- In what year were highest number of babies were named `Alex` in Minnesota?


`r countdown(minutes = 3, seconds = 00, top = 1, color_background = "inherit")`
---

class: center, inverse, bottom
background-image: url("images/data_viz.jpg")
background-size: contain


# .red[Data Visualization]


### provides a powerful way to communicate data-driven findings, motivate analyses, and detect flaw

---

# **ggplot2**  &mdash; Overview

- A powerful package for visualising data 

--

- Used widely by academics and industries alike

--

- Some useful resources

    - [The package documentation](https://www.rdocumentation.org/packages/ggplot2/versions/3.2.1)
    - [The book](https://ggplot2-book.org/) by its creator Hadley Wickham
    - [The reference page](https://ggplot2.tidyverse.org/reference/)
    - [The extensions](https://exts.ggplot2.tidyverse.org/), maintained by the `ggplot2` community

---
# **ggplot2** &mdash; Basics 

- The `ggplot` function and the `data` argument
  - specify a data frame in the main `ggplot` function

```{r, eval=FALSE, tidy=FALSE}
ggplot(data = df)
```

--

- The mapping aesthetics, or .yellow-h[aes]; most importantly, the variable(s) that we want to plot
  - specify as an additional argument in the same `ggplot` function

```{r, eval=FALSE, tidy=FALSE}
ggplot(data = df, mapping = aes(x = x-variable, y = y-variable))
```

---

# **ggplot2** &mdash; Basics

- The geometric objects, or .yellow-h[geom]; the visual representations
  - specify, after a plus sign .yellow-h[+], as an additional function

```{r, eval=FALSE, tidy=FALSE}
ggplot(data = df, mapping = aes(x = x-variable, y = y-variable)) +
       geom_point() #<<
```

- Additional aesthestics like `color`, `size`, `shape`, and `alpha` (i.e. transparency) are possible.
  
```{r, eval=FALSE, tidy=FALSE}
ggplot(data = df, mapping = aes(x = x-variable, y = y-variable)) +
       geom_point(color = z-variable) #<<
```

---

class: action

# Your Turn

```{r}
#install.packages("tidyverse")
library(tidyverse)
babynames_MN_John <- babynames %>% filter(state=="MN",  name == "John")
```


### Question 5: Basic Plot using `ggplot2`.

- What are the grammar of graphics needed to create a scatter-plot of the number of babies born in Minnesota named `John` vs year they were born?
- Fill in the data and aesthetic mapping in the below code chunk. What is returned? What's missing?
- Add the appropriate geometric object to create the scatter plot. This is called adding a *layer* to a plot.
- Repeat the above steps with babies named `John` from Minnesota or Michigan.


`r countdown(minutes = 3, seconds = 00, top = 1, color_background = "inherit")`

---

# Your Turn &mdash; add appropriate labels

````md
`r ''````{r}
ggplot(data = babynames_MN_MI_John , mapping = aes(x = year, y = number)) +
  geom_point(aes(colour=state))+
  xlab("Year") +
  ylab(bquote(Number~of~babies~named~.("John"))   
```
````

```{r, echo = FALSE, fig.height=4}
babynames_MN_MI_John <- babynames %>% filter(state=="MN" | state == "MI",  name == "John")
ggplot(data = babynames_MN_MI_John , mapping = aes(x = year, y = number)) +
  geom_point(aes(colour=state))+
  xlab("Year") +
  ylab(bquote(Number~of~babies~named~.("John")))+
  ggtitle("Number of babies named John over time") +
  theme(plot.title = element_text(hjust = 0.5))    # center the plot title
```



