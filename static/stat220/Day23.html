<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Model Accuracy and Evaluation</title>
    <meta charset="utf-8" />
    <meta name="author" content="Bastola" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>

    <link rel="stylesheet" href="css/xaringan-themer-solns.css" type="text/css" />
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="css/my-font.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">











layout: true
  
---

class: title-slide, middle

# .fancy[Model Accuracy and Evaluation]

### .fancy[Fall 2022]

 November 04 2022


---


class: middle

# Recap: KNN (K- Nearest Neighbor)

.bql.large[
- Supervised machine learning algorithm i.e., it requires labeled data for training

- Need to tell the algorithm the exact number of neighbors (K) we want to consider
]

---

class: middle

# Training and Testing

.bq.Large[
# .out-t[Training:] Fitting a model with certain hyper-parameters on a particular subset of the dataset
]

&lt;br&gt;

&lt;br&gt;

.bq.Large[
# .out-t[Testing:] Test the model on a different subset of the dataset to get an estimate of a final, unbiased assessment of the model's performance
]


---

class: middle
background-image: url("images/workflow.png")
background-position: left
background-size: 42%

.pull-right-60.large[

.bq[
# Workflows

A machine learning workflow (the “black box”) containing model specification and preprocessing recipe/formula
]
]

---

# Forest Fire : Data Description (Recall!)
&lt;br&gt;

Variable | Description
-------- | -------------
`Date` | (DD-MM-YYYY) Day, month, year 
`Temp` | Noon temperature in Celsius degrees: 22 to 42
`RH` | Relative Humidity in percentage: 21 to 90
`Ws` | Wind speed in km/h: 6 to 29
`Rain` | Daily total rain in mm: 0 to 16.8
`Fine Fuel Moisture Code (FFMC) index` | 28.6 to 92.5
`Duff Moisture Code (DMC) index` | 1.1 to 65.9
`Drought Code (DC) index` | 7 to 220.4
`Initial Spread Index (ISI) index` | 0 to 18.5
`Buildup Index (BUI) index` | 1.1 to 68
`Fire Weather Index (FWI) index` | 0 to 31.1
`Classes` | Two classes, namely .bold[fire] and .bold[not fire]


---

class: middle

# 1. Create a workflow: Split the raw data

.font150[

```r
set.seed(123) # set seed for reproducibility

# Prepare the raw dataset
fire_raw &lt;- fire %&gt;% select(temperature, isi, classes)

fire_split &lt;- initial_split(fire_raw, prop = 0.75) 

# Create training data
fire_train &lt;- fire_split %&gt;% training()


# Create testing data
fire_test &lt;- fire_split %&gt;% testing()
```
]

---

class: middle

# 2. Make a recipe

.font150[

```r
fire_recipe &lt;- recipe(classes ~ ., data = fire_raw) %&gt;%
  step_scale(all_predictors()) %&gt;% # scale the predictors
  step_center(all_predictors()) %&gt;% # center the predictors
  prep    # pre-process
```
]

---

class: middle

# 3. Specify the model

.font140[

```r
fire_knn_spec &lt;- nearest_neighbor(mode = "classification",
                                  engine = "kknn",
                                  weight_func = "rectangular",
                                  neighbors = 5)
```
]

---

class: middle

# 4. Define the workflow object

.font150[

```r
fire_workflow &lt;- workflow() %&gt;% # initialize a workflow
  add_recipe(fire_recipe) %&gt;% # add recipe
  add_model(fire_knn_spec) # add model specification
```
]


---

class: middle

# 5. Fit the model

.font150[

```r
fire_fit &lt;- fit(fire_workflow, data = fire_train)
```
]

---

class: middle

.code120[

```
══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: nearest_neighbor()

── Preprocessor ────────────────────────────────────────────────────────────────
2 Recipe Steps

• step_scale()
• step_center()

── Model ───────────────────────────────────────────────────────────────────────

Call:
kknn::train.kknn(formula = ..y ~ ., data = data, ks = min_rows(5,     data, 5), kernel = ~"rectangular")

Type of response variable: nominal
Minimal misclassification: 0.03296703
Best kernel: rectangular
Best k: 5
```
]

---

class: middle

# 6. Evaluate the model on test dataset

.font150[

```r
test_features &lt;- fire_test %&gt;% select(temperature, isi) 
fire_pred &lt;- predict(fire_fit, test_features)
fire_results &lt;- fire_test %&gt;% 
  select(classes) %&gt;% 
  bind_cols(predicted = fire_pred)
```
]

---
class: middle

# 7. Compare the known labels and predicted labels

.scroll-box-24[

```r
knitr::kable(fire_results)
```



|classes  |.pred_class |
|:--------|:-----------|
|not fire |not fire    |
|not fire |not fire    |
|fire     |fire        |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|fire     |fire        |
|fire     |fire        |
|not fire |not fire    |
|not fire |not fire    |
|not fire |fire        |
|fire     |fire        |
|fire     |fire        |
|not fire |not fire    |
|not fire |fire        |
|fire     |fire        |
|fire     |fire        |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|fire     |fire        |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|not fire |not fire    |
|fire     |fire        |
|not fire |not fire    |
|not fire |not fire    |
|fire     |fire        |
|not fire |not fire    |
|not fire |not fire    |
|fire     |fire        |
|not fire |not fire    |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|not fire |not fire    |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|fire     |fire        |
|not fire |not fire    |
|fire     |fire        |
|not fire |not fire    |
]

---




class: action, middle

# &lt;i class="fa fa-pencil-square-o" style="font-size:48px;color:purple"&gt;&amp;nbsp;Group&amp;nbsp;Activity&amp;nbsp;1&lt;/i&gt;    


.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[
&lt;br&gt;
&lt;br&gt;
.bq[
- Get the class activity 23.Rmd file from  [moodle](https://moodle.carleton.edu/course/view.php?id=39491) 
- Let's work on group activity 1 together
]



]

<div class="countdown" id="timer_c25d5ddd" data-update-every="1" tabindex="0" style="top:0;right:0;padding:3px 4px;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---


class: inverse, middle

# .Large[How do we choose the number of neighbors in a principled way?]

---

.panelset[
.panel[.panel-name[Visualizing boundary]
&lt;img src="Day23_files/figure-html/scale-fill-1.svg" width="65%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]
&lt;br&gt;
&lt;br&gt;
.code120[

```r
ggplot(data = fire1, aes(x = temperature, y = isi , fill = classes)) +
  geom_point(color = "black", pch = 21) +
  labs(x = "Temperature", y = "Initial Spread Index (ISI)") +
  #scale_fill_brewer(palette = "Set1") +
  scale_fill_wsj() +
  theme_tufte()
```
]
]
.panel[.panel-name[Take Away]
&lt;br&gt;
&lt;br&gt;
.bql.large.fancy[
- We normally don't have a clear separation between classes and usually have more than 2 features.

- Eyeballing on a plot to discern the classes is not very helpful in the practical sense
]

]
]


---

class: middle

## Evaluating accuracy

.yellow-h.large[We want to evaluate classifiers based on some accuracy metrics.]



.fancy.bq[
- Randomly split data set into two pieces: .bold[training set] and .bold[test set]

- Train (i.e. fit) KNN on the training set

- Make predictions on the test set

- See how good those predictions are
]


---

# Train (left) and test (right) dataset (50-50)




.pull-left[
&lt;img src="Day23_files/figure-html/unnamed-chunk-11-1.svg" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="Day23_files/figure-html/unnamed-chunk-12-1.svg" width="100%" style="display: block; margin: auto;" /&gt;
]

---





&lt;img src="Day23_files/figure-html/unnamed-chunk-14-1.svg" width="70%" style="display: block; margin: auto;" /&gt;

---


&lt;img src="Day23_files/figure-html/unnamed-chunk-15-1.svg" width="70%" style="display: block; margin: auto;" /&gt;


---

background-image: url("images/confusion_matrix.png")
background-position: center
background-size: 60%


---

background-image: url("images/confusion_matrix.png")
background-position: center
background-size: 60%

&lt;br&gt;

.out-t.center[Confusion matrix: tabulation of true (i.e. expected) and predicted class labels]

---

## Performance metrics


.bq[Common metrics include:

- accuracy
- sensitivity
- specificity
- positive predictive value (PPV)
]




.font120[

```r
conf_mat(fire_results, truth = classes, estimate = predicted)
          Truth
Prediction fire not fire
  fire       61        2
  not fire    6       53
```
]




---

## Accuracy

.bq[
Proportion of correctly classified cases
`$${\rm Accuracy} = \frac{\text{true positives} + \text{true negatives}}{n}$$`
]

.pull-left-40[

```
          Truth
Prediction fire not fire
  fire       61        2
  not fire    6       53
```
]
.pull-right-60[

```r
accuracy(fire_results, truth = classes, 
         estimate = predicted)
# A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.934
```
]


---

## Sensitivity

.bq[
Proportion of positive cases that are predicted to be positive
`$${\rm Sensitivity} = \frac{\text{true positives}}{ \text{true positives}+ \text{false negatives}}$$`
.bold[Also called...] true positive rate or recall
]

.pull-left-40[

```
          Truth
Prediction fire not fire
  fire       61        2
  not fire    6       53
```
]
.pull-right-60[

```r
sens(fire_results, truth = classes,
         estimate = predicted)
# A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 sens    binary         0.910
```
]

---

## Specificity

.bq[
Proportion of negative cases that are predicted to be negative
`$${\rm Specificity} = \frac{\text{true negatives}}{ \text{false positives}+ \text{true negatives}}$$`
.bold[Also called...] true negative rate
]

.pull-left-40[

```
          Truth
Prediction fire not fire
  fire       61        2
  not fire    6       53
```
]
.pull-right-60[

```r
spec(fire_results, truth = classes,
         estimate = predicted)
# A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 spec    binary         0.964
```
]

---

## Positive predictive value (PPV)

.bq[
Proportion of cases that are predicted to be positives that are truly positives
`$${\rm PPV} = \frac{\text{true positives}}{ \text{true positives} + \text{false positives}}$$`
.bold[Also called...] precision
]
.pull-left-40[

```
          Truth
Prediction fire not fire
  fire       61        2
  not fire    6       53
```
]
.pull-right-60[

```r
ppv(fire_results, truth = classes,
         estimate = predicted)
# A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 ppv     binary         0.968
```

]



---

class: action, middle

# &lt;i class="fa fa-pencil-square-o" style="font-size:48px;color:purple"&gt;&amp;nbsp;Group&amp;nbsp;Activity&amp;nbsp;2&lt;/i&gt;    


.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[
&lt;br&gt;
&lt;br&gt;
.bq[
- Please continue working on group activity 2
- Consider calculating the accuracy metrics bt hand 
- Verify your calculations with R-code

]

]

<div class="countdown" id="timer_83d48d02" data-update-every="1" tabindex="0" style="top:0;right:0;padding:3px 4px;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---

class: middle

## Tabulate the metrics !!

.font110[

```r
custom_metrics &lt;- metric_set(accuracy, sens, spec, ppv) # select custom metrics
metrics &lt;- custom_metrics(fire_results, truth = classes, estimate = predicted) 
metrics
# A tibble: 4 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.934
2 sens     binary         0.910
3 spec     binary         0.964
4 ppv      binary         0.968
```
]

---

# Choose the optimal K based on majority of the metrics!




&lt;img src="Day23_files/figure-html/unnamed-chunk-28-1.svg" width="90%" style="display: block; margin: auto;" /&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"highlightLanguage": ["r", "css", "yaml"],
"countIncrementalSlides": true,
"slideNumberFormat": "%current%",
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
