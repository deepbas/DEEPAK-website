<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Logistic Regression</title>
    <meta charset="utf-8" />
    <meta name="author" content="Bastola" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>

    <link rel="stylesheet" href="css/xaringan-themer-solns.css" type="text/css" />
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="css/my-font.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">










layout: true
  
---

class: title-slide, middle

# .fancy[Logistic Regression]

### .fancy[Stat 220]

 February 28 2024


---


class: inverse, middle

# .Large[Let's see an example of classification using simple logistic regression!]


---

class: middle

# Outline

.hljs[
- .b[Goal:] Understand why logistic regression is used for categorical outcomes.
- .b[Context:] Traditional linear regression is limited to continuous outcomes.
- .b[Solution:] Logistic regression models the probability of a categorical outcome.
]

---

class: middle

# Why Not Linear Regression?

.b[
- Issue with categorical outcomes: Predictions can fall outside the `\([0,1]\)` range.
- Consequence: Nonsensical probability predictions for binary outcomes `\((Y=0\text{ or }Y=1)\)`).
]

---

class: middle

# Introduction to Logistic Regression

.bold[
- Solution: Transform the outcome into a format that linear regression can handle.
- Method: Model the log odds of the probability of success versus failure.
]

---

class: middle

# From Probability to Odds

.bql[
- Probability: Chance of success ( `\(Y=1\)` ) over total possibilities.
`$$P(Y=1)=\frac{\text { number of successes }}{\text { total trials }}$$`
- Odds: Ratio of the probability of success to the probability of failure.
`$$Odds =\frac{P(Y=1)}{1-P(Y=1)}$$`
]


---

class: middle

# Logit Transformation


.bq[
- Goal: Convert odds to a continuous scale that can span negative to positive infinity.
- Logit Function: Natural logarithm of the odds.
`$$\log \left(\frac{P(Y=1)}{1-P(Y=1)}\right)$$`
- Why? Makes it possible to use linear regression techniques.
]


---

.panelset[

.panel[.panel-name[LR Visualization]

&lt;img src="Day24_files/figure-html/unnamed-chunk-1-1.svg" width="60%" style="display: block; margin: auto;" /&gt;

]



.panel[.panel-name[LR Summary]
.bq.font80[
- Binary response, `\(Y\)`,  with an explanatory (predictor, features) variables, `\(X_1\)`.
- We model the probability that `\(Y\)` belongs to a particular category.


`$$P(Y = 1 ) = \frac{e^{\beta_0 + \beta_1X_1}}{1 + e^{\beta_0 + \beta_1X_1}}$$`

`$$\text{Odds} = \frac{P(Y = 1 )}{1 - P(Y = 1 )} = e^{\beta_0 + \beta_1X_1}$$`

`$$\text{Log Odds} = \beta_0 + \beta_1X_1$$`
]

]




.panel[.panel-name[Data Preparation]


```r
# Create data split for train and test
set.seed(12345) # Ensures reproducibility of the data split
db_single &lt;- db %&gt;% 
  select(diabetes, glucose) %&gt;%  
  mutate(diabetes = fct_relevel(diabetes, c("neg", "pos"))) # Relevels 'diabetes' factor to ensure 'neg' comes before 'pos'
db_split &lt;- initial_split(db_single, prop = 0.80) 
db_train &lt;- db_split %&gt;% training()
db_test &lt;- db_split %&gt;% testing() 
```
]


.panel[.panel-name[Modeling]


```r
set.seed(12345) # Ensures reproducibility in model results
db_recipe &lt;- recipe(diabetes ~ ., data = db_train) %&gt;% # Defines preprocessing recipe for modeling
  step_scale(all_predictors()) %&gt;% # Scales all predictor variables
  step_center(all_predictors()) %&gt;% prep() # Centers all predictor variables and prepares recipe

fitted_logistic_model &lt;- logistic_reg(engine = "glm",  # Specifies logistic regression model using glm engine
                                      mode = "classification") %&gt;% # Sets model to classification mode
                        fit(diabetes~., data = db_train)  # Fits model to training data
```

]
]

---

class: middle

# Tidy the Summary


```r
broom::tidy(fitted_logistic_model)
# A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -5.61     0.678       -8.28 1.20e-16
2 glucose       0.0392   0.00514      7.62 2.55e-14
```



`$$\log \left(\frac{p}{1-p}\right)=-5.61+0.0392 \cdot \text { glucose }$$`

Where `\(p = P(Y = 1)\)` is the probability of having diabetes 

---

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;


# Interpreting Coefficients: Log Odds

.b[
- Coefficient Meaning: Change in log odds of the outcome for a one-unit increase in the predictor.
]

--

.hljs.blue[A coefficient of 0.0392 for glucose means...]

--

.hljs.blue[...a one-unit increase in glucose level increases the log odds of diabetes by 0.0392.]

---

&lt;br&gt;
&lt;br&gt;

# Exponentiating Coefficients: Odds Ratios

`$$Odds = \frac{probability}{1 - probability}$$`



```r
broom::tidy(fitted_logistic_model, exponentiate = TRUE)
# A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  0.00364   0.678       -8.28 1.20e-16
2 glucose      1.04      0.00514      7.62 2.55e-14
```

--

`$$\text { Odds }=0.00364 \times(1.04)^{\text {glucose }}$$`
--

.blue-h[An odds ratio of 1.04 means that for each additional unit of glucose, the odds of having diabetes increase by 4%.]

---

class: middle

# Understanding Odds Ratios

.bold[
- Transformation: Turning log-odds coefficients into odds ratios.
- Odds Ratio `\(=e^{\beta_i}\)`
- Interpretation: For each unit increase in the predictor, the odds multiply by the odds ratio.
]


---



class: action, middle

# &lt;i class="fa fa-pencil-square-o" style="font-size:48px;color:purple"&gt;&amp;nbsp;Group&amp;nbsp;Activity&amp;nbsp;1&lt;/i&gt;    


.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[

.bq[
- Get the class activity 24.Rmd file from  [moodle](https://moodle.carleton.edu/course/view.php?id=43045) 
- Let's work on group activity 1 together
]

.b[Hint:
- Calculate log odds: `\(-5.61 + (0.0392 \times 150)\)`
- Convert log odds to odds: `\(e^{\text{log odds}}\)`
- Convert odds to probability: `\(\frac{\text{Odds}}{1 + \text{Odds}}\)`]

]

<div class="countdown" id="timer_5539c0e5" data-update-every="1" tabindex="0" style="top:0;right:0;padding:3px 4px;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---

# Threshold for classification

&lt;img src="Day24_files/figure-html/unnamed-chunk-6-1.svg" width="60%" style="display: block; margin: auto;" /&gt;


---


class: middle

# Class Prediction

.code80[

```r
set.seed(12345)
pred_class &lt;- predict(fitted_logistic_model,  new_data = db_test) 
bind_cols(db_test %&gt;% select(diabetes), pred_class) %&gt;% 
  conf_mat(diabetes, .pred_class) %&gt;% # confusion matrix
  autoplot(type = "heatmap") # with graphics
```

&lt;img src="Day24_files/figure-html/unnamed-chunk-7-1.svg" width="50%" style="display: block; margin: auto;" /&gt;
]

---

# Class Probabilities with `threshold = 0.70`


```r
# Prediction Probabilities
library(probably)
pred_prob &lt;- predict(fitted_logistic_model,  new_data = db_test,   type = "prob")

db_results &lt;- db_test %&gt;% bind_cols(pred_prob) %&gt;%
  mutate(.pred_class = make_two_class_pred(.pred_neg, levels(diabetes), threshold = .7)) %&gt;%
  select(diabetes, glucose, contains(".pred"))
```


```
    diabetes glucose .pred_neg  .pred_pos .pred_class
25       pos     143 0.5040090 0.49599103         pos
52       neg     101 0.8402912 0.15970881         neg
60       neg     105 0.8181391 0.18186086         neg
64       neg     141 0.5235673 0.47643271         pos
69       neg      95 0.8693592 0.13064080         neg
83       neg      83 0.9141287 0.08587128         neg
98       neg      71 0.9445349 0.05546507         neg
110      pos      95 0.8693592 0.13064080         neg
135      neg      96 0.8648480 0.13515203         neg
143      neg     108 0.8000067 0.19999330         neg
```


---

class: middle

# Custom Metrics

.pull-left[
&lt;img src="Day24_files/figure-html/unnamed-chunk-10-1.svg" width="90%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

```r
custom_metrics &lt;- metric_set(accuracy, 
                             sens, 
                             spec, 
                             ppv)
custom_metrics(db_results,
               truth = diabetes,
               estimate = .pred_class)
# A tibble: 4 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.785
2 sens     binary         0.754
3 spec     binary         0.864
4 ppv      binary         0.935
```
]

---


# Class Probabilities with `threshold = 0.70`


```r
# Prediction Probabilities
library(probably)
pred_prob &lt;- predict(fitted_logistic_model,  new_data = db_test,   type = "prob")

db_results &lt;- db_test %&gt;% bind_cols(pred_prob) %&gt;%
  mutate(.pred_class = make_two_class_pred(.pred_neg, levels(diabetes), threshold = .70)) %&gt;%
  select(diabetes, glucose, contains(".pred"))
```


```
    diabetes glucose .pred_neg  .pred_pos .pred_class
25       pos     143 0.5040090 0.49599103         pos
52       neg     101 0.8402912 0.15970881         neg
60       neg     105 0.8181391 0.18186086         neg
64       neg     141 0.5235673 0.47643271         pos
69       neg      95 0.8693592 0.13064080         neg
83       neg      83 0.9141287 0.08587128         neg
98       neg      71 0.9445349 0.05546507         neg
110      pos      95 0.8693592 0.13064080         neg
135      neg      96 0.8648480 0.13515203         neg
143      neg     108 0.8000067 0.19999330         neg
```


---

class: middle

# Custom Metrics

.pull-left[
&lt;img src="Day24_files/figure-html/unnamed-chunk-14-1.svg" width="90%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

```r
custom_metrics &lt;- metric_set(accuracy, 
                             sens, 
                             spec, 
                             ppv)
custom_metrics(db_results,
               truth = diabetes,
               estimate = .pred_class)
# A tibble: 4 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.785
2 sens     binary         0.754
3 spec     binary         0.864
4 ppv      binary         0.935
```
]

---

class: action, middle

# &lt;i class="fa fa-pencil-square-o" style="font-size:48px;color:purple"&gt;&amp;nbsp;Group&amp;nbsp;Activity&amp;nbsp;2&lt;/i&gt;    


.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[
&lt;br&gt;
&lt;br&gt;
.bq[
- Please continue working on group activity 2
]

]

<div class="countdown" id="timer_4bfaa120" data-update-every="1" tabindex="0" style="top:0;right:0;padding:3px 4px;font-size:2em;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">30</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"highlightLanguage": ["r", "css", "yaml"],
"countIncrementalSlides": true,
"slideNumberFormat": "%current%",
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
