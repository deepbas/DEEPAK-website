<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>More date and time and strings</title>
    <meta charset="utf-8" />
    <meta name="author" content="Bastola" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>

    <link rel="stylesheet" href="css/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

.title[
# More date and time and strings
]
.subtitle[
## <br/> STAT 220
]
.author[
### Bastola
]
.date[
### September 10 2022
]

---









# Reading the Energy Dataset 


```r
energy &lt;- read_csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/energy.csv",
                    col_type = cols(
                     .default = col_double(), 
                      Timestamp = col_datetime(format = ""),
                      dayWeek = col_factor(levels=c("Mon","Tues","Wed","Thurs","Fri","Sat","Sun"))
                     ))
```

--


```r
energy %&gt;% slice_max(n=2, order_by = Timestamp) 
# A tibble: 2 × 90
  Timestamp            year month weekOfYear dayOfMonth dayWeek timeHour timeM…¹
  &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;   &lt;dbl&gt;
1 2016-08-31 23:45:00  2016     8         35         31 Wed           23      45
2 2016-08-31 23:30:00  2016     8         35         31 Wed           23      30
# … with 82 more variables: `100_Nevada_Street` &lt;dbl&gt;, `104_Maple_St.` &lt;dbl&gt;,
#   `106_Winona_St.` &lt;dbl&gt;, Allen_House &lt;dbl&gt;,
#   `Alumni_Guest_House/Johnson_House` &lt;dbl&gt;, Arboretum_Office &lt;dbl&gt;,
#   Art_Studios &lt;dbl&gt;, Benton_House &lt;dbl&gt;, Berg_House &lt;dbl&gt;, Bird_House &lt;dbl&gt;,
#   Boliou_Memorial_Art_Bldg. &lt;dbl&gt;, Burton_Hall &lt;dbl&gt;,
#   `Cassat_Hall_/_James_Hall` &lt;dbl&gt;,
#   `Center_for_Mathematics_&amp;_Computing` &lt;dbl&gt;, Chaney_House &lt;dbl&gt;, …
```



---

# Wide to Long 


```r
energy_narrow &lt;- energy %&gt;%
  pivot_longer( cols = `100_Nevada_Street`:Wilson_House, names_to = "building", values_to = "energyKWH")
```


```r
energy_narrow
# A tibble: 2,880,578 × 10
   Timestamp            year month weekOfYear dayOfMonth dayWeek timeH…¹ timeM…²
   &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 2 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 3 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 4 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 5 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 6 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 7 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 8 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
 9 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
10 2015-09-01 00:00:00  2015     9         35          1 Tues          0       0
# … with 2,880,568 more rows, 2 more variables: building &lt;chr&gt;,
#   energyKWH &lt;dbl&gt;, and abbreviated variable names ¹​timeHour, ²​timeMinute
```

---

# Dates and times manipulation

.pull-left[


```r
energy$Timestamp[1]
[1] "2015-09-01 UTC"
## [1] "2015-09-01 UTC"
as.numeric(energy$Timestamp[1])
[1] 1441065600
## [1] 1441065600

# 5th timestamp
( stamp5 &lt;- energy$Timestamp[5] )
[1] "2015-09-01 01:00:00 UTC"
```
]
--
.pull-right[

```r
mdy("1/4/2021")
[1] "2021-01-04"

dmy_hms("01/04/2020-01-30-23")
[1] "2020-04-01 01:30:23 UTC"
```


```r
make_datetime(year = 2022,
              month = 1, 
              day = 5, 
              hour = 10,
              sec = 20)
[1] "2022-01-05 10:00:20 UTC"
```
]

---

# Measuring time

.pull-left[

```r
first_day &lt;- ymd_hm("2022-01-05 12:30")
classtime &lt;- now() - first_day
classtime
Time difference of 248.3928 days
```


```r
as.period(classtime)
[1] "248d 9H 25M 40.8035001754761S"
as.duration(classtime)
[1] "21461140.8035002s (~35.48 weeks)"
```
]
--
.pull-right[


```r
diff1 &lt;- first_day %--% now()
diff1/dminutes(1)
[1] 357685.7
```


```r
diff2 &lt;- interval(first_day, now())
diff2/dminutes(1)
[1] 357685.7
```

]


---
count: false
 
## Top ten destination
.panel1-demo1-auto[

```r
*data("flights", package = "nycflights13")
```
]
 
.panel2-demo1-auto[

]

---
count: false
 
## Top ten destination
.panel1-demo1-auto[

```r
data("flights", package = "nycflights13")

*flights
```
]
 
.panel2-demo1-auto[

```
# A tibble: 336,776 × 19
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      517        515       2     830     819      11 UA     
 2  2013     1     1      533        529       4     850     830      20 UA     
 3  2013     1     1      542        540       2     923     850      33 AA     
 4  2013     1     1      544        545      -1    1004    1022     -18 B6     
 5  2013     1     1      554        600      -6     812     837     -25 DL     
 6  2013     1     1      554        558      -4     740     728      12 UA     
 7  2013     1     1      555        600      -5     913     854      19 B6     
 8  2013     1     1      557        600      -3     709     723     -14 EV     
 9  2013     1     1      557        600      -3     838     846      -8 B6     
10  2013     1     1      558        600      -2     753     745       8 AA     
# … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay
```
]

---
count: false
 
## Top ten destination
.panel1-demo1-auto[

```r
data("flights", package = "nycflights13")

flights %&gt;%
* count(dest)
```
]
 
.panel2-demo1-auto[

```
# A tibble: 105 × 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ABQ     254
 2 ACK     265
 3 ALB     439
 4 ANC       8
 5 ATL   17215
 6 AUS    2439
 7 AVL     275
 8 BDL     443
 9 BGR     375
10 BHM     297
# … with 95 more rows
```
]

---
count: false
 
## Top ten destination
.panel1-demo1-auto[

```r
data("flights", package = "nycflights13")

flights %&gt;%
  count(dest) %&gt;%
* slice_max(n, n = 10)
```
]
 
.panel2-demo1-auto[

```
# A tibble: 10 × 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ORD   17283
 2 ATL   17215
 3 LAX   16174
 4 BOS   15508
 5 MCO   14082
 6 CLT   14064
 7 SFO   13331
 8 FLL   12055
 9 MIA   11728
10 DCA    9705
```
]

---
count: false
 
## Top ten destination
.panel1-demo1-auto[

```r
data("flights", package = "nycflights13")

flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

```
]
 
.panel2-demo1-auto[

```
# A tibble: 10 × 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ORD   17283
 2 ATL   17215
 3 LAX   16174
 4 BOS   15508
 5 MCO   14082
 6 CLT   14064
 7 SFO   13331
 8 FLL   12055
 9 MIA   11728
10 DCA    9705
```
]

&lt;style&gt;
.panel1-demo1-auto {
  color: black;
  width: 58.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 70%
}
.panel2-demo1-auto {
  color: black;
  width: 39.2%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 70%
}
.panel3-demo1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 70%
}
&lt;/style&gt;






---



count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
*top_dest &lt;- flights
```
]
 
.panel2-demo2-auto[

]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
* count(dest)
```
]
 
.panel2-demo2-auto[

]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
* slice_max(n, n = 10)
```
]
 
.panel2-demo2-auto[

]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

*flights
```
]
 
.panel2-demo2-auto[

```
# A tibble: 336,776 × 19
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      517        515       2     830     819      11 UA     
 2  2013     1     1      533        529       4     850     830      20 UA     
 3  2013     1     1      542        540       2     923     850      33 AA     
 4  2013     1     1      544        545      -1    1004    1022     -18 B6     
 5  2013     1     1      554        600      -6     812     837     -25 DL     
 6  2013     1     1      554        558      -4     740     728      12 UA     
 7  2013     1     1      555        600      -5     913     854      19 B6     
 8  2013     1     1      557        600      -3     709     723     -14 EV     
 9  2013     1     1      557        600      -3     838     846      -8 B6     
10  2013     1     1      558        600      -2     753     745       8 AA     
# … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
* semi_join(top_dest)
```
]
 
.panel2-demo2-auto[

```
# A tibble: 141,145 × 19
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      542        540       2     923     850      33 AA     
 2  2013     1     1      554        600      -6     812     837     -25 DL     
 3  2013     1     1      554        558      -4     740     728      12 UA     
 4  2013     1     1      555        600      -5     913     854      19 B6     
 5  2013     1     1      557        600      -3     838     846      -8 B6     
 6  2013     1     1      558        600      -2     753     745       8 AA     
 7  2013     1     1      558        600      -2     924     917       7 UA     
 8  2013     1     1      558        600      -2     923     937     -14 UA     
 9  2013     1     1      559        559       0     702     706      -4 B6     
10  2013     1     1      600        600       0     851     858      -7 B6     
# … with 141,135 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
* mutate(sch_datetime = make_datetime(
*   year = year, month = month,
*   day = day, hour = hour,
*   min = minute)
*   )
```
]
 
.panel2-demo2-auto[

```
# A tibble: 141,145 × 20
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      542        540       2     923     850      33 AA     
 2  2013     1     1      554        600      -6     812     837     -25 DL     
 3  2013     1     1      554        558      -4     740     728      12 UA     
 4  2013     1     1      555        600      -5     913     854      19 B6     
 5  2013     1     1      557        600      -3     838     846      -8 B6     
 6  2013     1     1      558        600      -2     753     745       8 AA     
 7  2013     1     1      558        600      -2     924     917       7 UA     
 8  2013     1     1      558        600      -2     923     937     -14 UA     
 9  2013     1     1      559        559       0     702     706      -4 B6     
10  2013     1     1      600        600       0     851     858      -7 B6     
# … with 141,135 more rows, 10 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, sch_datetime &lt;dttm&gt;, and abbreviated
#   variable names ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time,
#   ⁵​arr_delay
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
  mutate(sch_datetime = make_datetime(
    year = year, month = month,
    day = day, hour = hour,
    min = minute)
    ) %&gt;%
* select(dest, sch_datetime)
```
]
 
.panel2-demo2-auto[

```
# A tibble: 141,145 × 2
   dest  sch_datetime       
   &lt;chr&gt; &lt;dttm&gt;             
 1 MIA   2013-01-01 05:40:00
 2 ATL   2013-01-01 06:00:00
 3 ORD   2013-01-01 05:58:00
 4 FLL   2013-01-01 06:00:00
 5 MCO   2013-01-01 06:00:00
 6 ORD   2013-01-01 06:00:00
 7 LAX   2013-01-01 06:00:00
 8 SFO   2013-01-01 06:00:00
 9 BOS   2013-01-01 05:59:00
10 FLL   2013-01-01 06:00:00
# … with 141,135 more rows
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
  mutate(sch_datetime = make_datetime(
    year = year, month = month,
    day = day, hour = hour,
    min = minute)
    ) %&gt;%
  select(dest, sch_datetime) %&gt;%
* group_by(dest)
```
]
 
.panel2-demo2-auto[

```
# A tibble: 141,145 × 2
# Groups:   dest [10]
   dest  sch_datetime       
   &lt;chr&gt; &lt;dttm&gt;             
 1 MIA   2013-01-01 05:40:00
 2 ATL   2013-01-01 06:00:00
 3 ORD   2013-01-01 05:58:00
 4 FLL   2013-01-01 06:00:00
 5 MCO   2013-01-01 06:00:00
 6 ORD   2013-01-01 06:00:00
 7 LAX   2013-01-01 06:00:00
 8 SFO   2013-01-01 06:00:00
 9 BOS   2013-01-01 05:59:00
10 FLL   2013-01-01 06:00:00
# … with 141,135 more rows
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
  mutate(sch_datetime = make_datetime(
    year = year, month = month,
    day = day, hour = hour,
    min = minute)
    ) %&gt;%
  select(dest, sch_datetime) %&gt;%
  group_by(dest) %&gt;%
* arrange(sch_datetime)
```
]
 
.panel2-demo2-auto[

```
# A tibble: 141,145 × 2
# Groups:   dest [10]
   dest  sch_datetime       
   &lt;chr&gt; &lt;dttm&gt;             
 1 MIA   2013-01-01 05:40:00
 2 ORD   2013-01-01 05:58:00
 3 BOS   2013-01-01 05:59:00
 4 ATL   2013-01-01 06:00:00
 5 FLL   2013-01-01 06:00:00
 6 MCO   2013-01-01 06:00:00
 7 ORD   2013-01-01 06:00:00
 8 LAX   2013-01-01 06:00:00
 9 SFO   2013-01-01 06:00:00
10 FLL   2013-01-01 06:00:00
# … with 141,135 more rows
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
  mutate(sch_datetime = make_datetime(
    year = year, month = month,
    day = day, hour = hour,
    min = minute)
    ) %&gt;%
  select(dest, sch_datetime) %&gt;%
  group_by(dest) %&gt;%
  arrange(sch_datetime) %&gt;%
* mutate(
*   diff1 = (lag(sch_datetime) %--%
*                   sch_datetime)/minutes(1),
*   diff2 = interval(lag(sch_datetime),
*                   sch_datetime)/minutes(1))
```
]
 
.panel2-demo2-auto[

```
# A tibble: 141,145 × 4
# Groups:   dest [10]
   dest  sch_datetime        diff1 diff2
   &lt;chr&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;
 1 MIA   2013-01-01 05:40:00    NA    NA
 2 ORD   2013-01-01 05:58:00    NA    NA
 3 BOS   2013-01-01 05:59:00    NA    NA
 4 ATL   2013-01-01 06:00:00    NA    NA
 5 FLL   2013-01-01 06:00:00    NA    NA
 6 MCO   2013-01-01 06:00:00    NA    NA
 7 ORD   2013-01-01 06:00:00     2     2
 8 LAX   2013-01-01 06:00:00    NA    NA
 9 SFO   2013-01-01 06:00:00    NA    NA
10 FLL   2013-01-01 06:00:00     0     0
# … with 141,135 more rows
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
  mutate(sch_datetime = make_datetime(
    year = year, month = month,
    day = day, hour = hour,
    min = minute)
    ) %&gt;%
  select(dest, sch_datetime) %&gt;%
  group_by(dest) %&gt;%
  arrange(sch_datetime) %&gt;%
  mutate(
    diff1 = (lag(sch_datetime) %--%
                    sch_datetime)/minutes(1),
    diff2 = interval(lag(sch_datetime),
                    sch_datetime)/minutes(1)) %&gt;%
* summarize(medianMins1 = median(diff1,
*                                na.rm=TRUE),
*           medianMins2 = median(diff2,
*                                na.rm=TRUE))
```
]
 
.panel2-demo2-auto[

```
# A tibble: 10 × 3
   dest  medianMins1 medianMins2
   &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 ATL            15          15
 2 BOS            17          17
 3 CLT            18          18
 4 DCA            34          34
 5 FLL            24          24
 6 LAX            19          19
 7 MCO            20          20
 8 MIA            25          25
 9 ORD            15          15
10 SFO            20          20
```
]

---
count: false
 
## Duration using lubridate
.panel1-demo2-auto[

```r
top_dest &lt;- flights %&gt;%
  count(dest) %&gt;%
  slice_max(n, n = 10)

flights %&gt;%
  semi_join(top_dest) %&gt;%
  mutate(sch_datetime = make_datetime(
    year = year, month = month,
    day = day, hour = hour,
    min = minute)
    ) %&gt;%
  select(dest, sch_datetime) %&gt;%
  group_by(dest) %&gt;%
  arrange(sch_datetime) %&gt;%
  mutate(
    diff1 = (lag(sch_datetime) %--%
                    sch_datetime)/minutes(1),
    diff2 = interval(lag(sch_datetime),
                    sch_datetime)/minutes(1)) %&gt;%
  summarize(medianMins1 = median(diff1,
                                 na.rm=TRUE),
            medianMins2 = median(diff2,
                                 na.rm=TRUE))

```
]
 
.panel2-demo2-auto[

```
# A tibble: 10 × 3
   dest  medianMins1 medianMins2
   &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 ATL            15          15
 2 BOS            17          17
 3 CLT            18          18
 4 DCA            34          34
 5 FLL            24          24
 6 LAX            19          19
 7 MCO            20          20
 8 MIA            25          25
 9 ORD            15          15
10 SFO            20          20
```
]

&lt;style&gt;
.panel1-demo2-auto {
  color: black;
  width: 50.96%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 70%
}
.panel2-demo2-auto {
  color: black;
  width: 47.04%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 70%
}
.panel3-demo2-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 70%
}
&lt;/style&gt;






---

# String Parsing

- .Large[**Powerful tool useful for overcoming many data wrangling challenges**]

&lt;!-- manipulate (or parse) textual data by looking for patterns in a string --&gt;

- .Large[The most common tasks in string processing include:]

  + .yellow-h[extracting] numbers from strings
  + .yellow-h[removing] unwanted characters from text
  + .yellow-h[finding and replacing] characters
  + .yellow-h[extracting] specific parts of strings
  + .yellow-h[converting] free form text to more uniform formats
  + .yellow-h[splitting] strings into multiple values

---

# `stringr` package

&lt;!-- add a picture --&gt;

.pull-left-60[
&lt;!-- The main types of string processing tasks are --&gt;

  + detecting, locating, extracting and replacing elements of strings.
  
&lt;!-- The **stringr** package from the **tidyverse** includes a variety of string processing functions that --&gt;  

  +  begin with `str_` and take the string as the first argument
  
&lt;!-- which makes them compatible with the pipe. --&gt;
]
.pull-right-40[

![](images/stringr.png)]



---


# Regular expressions: Regex

  &lt;!-- Use **regular expressions (regex)** to process strings. --&gt;


- A way to describe a specific pattern of characters of text. 

- To use regex in R, you need to use the **stringr** package

- **stringr** functions can take a regex as a pattern.

- Main difference between a regex and a regular string is that a regex can include special characters.


---

# Defining Strings

  * A string is any sequence of characters

  * Define a string by surrounding text with either single quotes or double quotes.
  

```r
s &lt;- "Hello!"    # double quotes define a string
s &lt;- 'Hello!'    # single quotes define a string  
```
  
--

  * The `cat()` or `writeLines()` function displays a string as it is represented inside R.

.pull-left[

```r
cat(s)
Hello!
```
]
.pull-right[

```r
writeLines(s)
Hello!
```
]


--


```r
s &lt;- `Hello`    # backquotes do not define a string
s &lt;- "10""    # error - unclosed quotes
```

---

# Special characters
  
  * The "escape" backslash \ is used to escape the special use of certain characters 


```r
writeLines("\"")
"
writeLines("\\")
\
writeLines("Math\\Stats")
Math\Stats
```

--

  * To include both single and double quotes in string, escape with \
  
&lt;!--  To include a double quote inside a string, use single quotes on the outside. To include a single quote inside a string, use double quotes on the outside. --&gt;

--


```r
s &lt;- '5\'10"'    # outer single quote
cat(s)
5'10"
```

--


```r
s &lt;- "5'10\""    # outer double quote
cat(s)
5'10"
```

---

# More Special Characters

- The | symbol inside a regex means `"or"`.


- Use `\\s` to match white space characters (spaces, tabs, and newlines)


- Use `\\w` to match alphanumeric characters (letters and numbers)


- Use `\\d` to represent digits (numbers)

&lt;!-- The backlash is used to distinguish it from the character `'d'`. --&gt;

---

## More Special Characters

- .out-t[`^`] = start of a string

- .out-t[`$`] = end of a string

- .out-t[`.`] = any character

- .out-t[`[:alpha:]`] = any letter

- .out-t[`[:digit:]`] = any digit

--

## Quantifiers

- .out-t[`*`] = matches the preceding character any number of times

- .out-t[`+`] = matches the preceding character once

- .out-t[`?`] = matches the preceding character at most once (i.e. optionally)

- .out-t[{n}] = matches the preceding character exactly n times


---

#  Combining strings


```r
str_c("fire", "man")
[1] "fireman"
```

--


```r
a &lt;- c("a", "b", "c")
b &lt;- c("A", "B", "C")
str_c(a, b)
[1] "aA" "bB" "cC"
```

--


```r
building &lt;- "CMC"
room &lt;- "102"
begin_time &lt;- "12:30 p.m."
end_time &lt;- "01:40 p.m."
days &lt;- "MWF"
class &lt;- "STAT 220"
str_c(class, "meets from", begin_time, "to", end_time, 
      days, "in", building, room, sep=" ")
[1] "STAT 220 meets from 12:30 p.m. to 01:40 p.m. MWF in CMC 102"
```

---

# `str_detect()`

- `str_detect()` indicates whether a pattern is present in a string.





```r
head(murders_raw)
# A tibble: 6 × 4
  state      population total murder_rate
  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
1 Alabama    4,853,875  348           7.2
2 Alaska     737,709    59            8  
3 Arizona    6,817,565  309           4.5
4 Arkansas   2,977,853  181           6.1
5 California 38,993,940 1,861         4.8
6 Colorado   5,448,819  176           3.2
```



```r
# detect whether a comma is present

pattern &lt;- ","
str_detect(murders_raw$population, pattern) 
 [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[16] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[31] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[46] TRUE TRUE TRUE TRUE TRUE TRUE
```

---

# `str_detect()`


```r
days &lt;- rep(c("Monday", "Tuesday", "Wednesday", 
              "Thursday", "Friday", "Saturday", "Sunday"),2)
```

--


```r
str_detect(days, "^[Ss]un.*")
 [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
[13] FALSE  TRUE
```

--


```r
identical(str_detect(days, "Su"), str_detect(days, "^[Ss]un.*"))
[1] TRUE
```

--


```r
days %&gt;% 
 
* str_which("^T")  #indices of matching entries
[1]  2  4  9 11
```


---

# `str_subset()`

- returns all values in a vector which match a pattern


```r
gapminder$country %&gt;% 
  unique() %&gt;% 
  str_subset("^[CU].*a$")
[1] "Cambodia"   "Canada"     "China"      "Colombia"   "Costa Rica"
[6] "Croatia"    "Cuba"       "Uganda"    
```

--


```r
# columns with names starting with "c"
gapminder %&gt;% names() %&gt;% str_subset("^c")
[1] "country"   "continent"
```


---

# `str_extract()` and `str_sub()`

- extracts parts of strings based on their position with the start and end arguments


```r
gapminder %&gt;% 
  names() %&gt;% 
* str_sub(start = 1, end = 6) #return the 1st 6 characters of each column name
[1] "countr" "contin" "year"   "lifeEx" "pop"    "gdpPer"
```

--

- extract just the part of the string matching the specified regex instead of the entire entry


```r
name_phone &lt;- c("Moly: 250-999-8878", 
       "Ali: 416-908-2044", 
       "Eli: 204-192-9829", 
       "May: 250-209-7047")

str_extract(name_phone, "[:alpha:]*") 
[1] "Moly" "Ali"  "Eli"  "May" 
```


---

# `str_split()`

- Splits a string into a list or matrix of pieces based on a supplied pattern



```r
str_split(c("a_3", "d_54"), pattern = "_") # returns a list
[[1]]
[1] "a" "3"

[[2]]
[1] "d"  "54"
```

--


```r
str_split(c("a_3", "d_54"), pattern = "_", simplify = TRUE) # returns a matrix
     [,1] [,2]
[1,] "a"  "3" 
[2,] "d"  "54"
```


---



# `str_replace()`

`str_replace()` replaces the first instance of the detected pattern with a specified string.


```r
gap_names &lt;- gapminder %&gt;% names

str_replace(gap_names, 
            pattern = "^.{3}", # match the 1st 3 characters of each string in the vector
            replacement = "X_")
[1] "X_ntry"   "X_tinent" "X_r"      "X_eExp"   "X_"       "X_Percap"
```

---

class: action

# Your turn 1


Please git clone the repository on [basic string manipulation](https://github.com/stat220/09-basic-string) to your local folder. 


```r
cell_info
 [1] "Specimen1_RNA_SARS5_2022-03-13"  "Specimen2_RNA_H5N1_2022-01-26"  
 [3] "Specimen3_RNA_SARS5_2022-01-07"  "Specimen4_DNA_COV19_2022-05-17" 
 [5] "Specimen5_RNA_H5N1_2022-03-19"   "Specimen6_DNA_COV19_2022-03-22" 
 [7] "Specimen7_DNA_COV19_2022-02-12"  "Specimen8_DNA_H5N1_2022-04-13"  
 [9] "Specimen9_RNA_H5N1_2022-04-27"   "Specimen10_RNA_H5N1_2022-03-17" 
[11] "Specimen11_DNA_H5N1_2022-02-01"  "Specimen12_DNA_COV19_2022-04-19"
```

- Complete the required tasks using `str_subset`, `str_extract`, `str_split` and `str_replace`.

<div class="countdown" id="timer_e19cd78f" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">07</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">30</span></code>
</div>


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "tomorrow",
"highlightLines": true,
"highlightLanguage": "r",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
(function(time) {
  var d2 = function(number) {
    return ('0' + number).slice(-2); // left-pad 0 to minutes/seconds
  },

  time_format = function(total) {
    var secs = Math.abs(total) / 1000;
    var h = Math.floor(secs / 3600);
    var m = Math.floor(secs % 3600 / 60);
    var s = Math.round(secs % 60);
    var res = d2(m) + ':' + d2(s);
    if (h > 0) res = h + ':' + res;
    return res;  // [hh:]mm:ss
  },

  slide_number_div = function(i) {
    return document.getElementsByClassName('remark-slide-number').item(i);
  },

  current_page_number = function(i) {
    return slide_number_div(i).firstChild.textContent;  // text "i / N"
  };

  var timer = document.createElement('span'); timer.id = 'slide-time-left';
  var time_left = time, k = slideshow.getCurrentSlideIndex(),
      last_page_number = current_page_number(k);

  setInterval(function() {
    time_left = time_left - 1000;
    timer.innerHTML = ' ' + time_format(time_left);
    if (time_left < 0) timer.style.color = 'red';
  }, 1000);

  slide_number_div(k).appendChild(timer);

  slideshow.on('showSlide', function(slide) {
    var i = slide.getSlideIndex(), n = current_page_number(i);
    // reset timer when a new slide is shown and the page number is changed
    if (last_page_number !== n) {
      time_left = time; last_page_number = n;
      timer.innerHTML = ' ' + time_format(time); timer.style.color = null;
    }
    slide_number_div(i).appendChild(timer);
  });
})(60000);
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
