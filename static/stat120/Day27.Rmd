---
title: "Regression"
subtitle: "<br/> STAT 120"
author: "Bastola"
date: "`r format(Sys.Date(), ' %B %d %Y')`"
output:
  xaringan::moon_reader:
    css: ["default", css/xaringan-themer-solns.css, css/my-theme.css, css/my-font.css]
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    seal: false
    nature:
      highlightStyle: googlecode  #http://arm.rbind.io/slides/xaringan.html#77 # idea, magula
      highlightLines: true
      highlightLanguage: ["r", "css", "yaml"]
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
      titleSlideClass: ["left", "middle", "inverse"]
      ratio: "16:9"
    includes:
      in_header: header.html
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
options(htmltools.preserve.raw = FALSE)
options(ggrepel.max.overlaps = Inf)

knitr::opts_chunk$set(echo = TRUE, 
                      dev = 'svg',
                      collapse = FALSE, 
                      comment = NA,  # PRINTS IN FRONT OF OUTPUT, default is '##' which comments out output
                      prompt = FALSE, # IF TRUE adds a > before each code input
                      warning = FALSE, 
                      message = FALSE,
                      fig.height = 3, 
                      fig.width = 4,
                      out.width = "100%"
                      )

# load necessary packages
library(tidyverse)
library(dplyr)
library(countdown)
library(ggthemes)
library(xaringanExtra)
library(forcats)
xaringanExtra::use_panelset()
xaringanExtra::use_tachyons()
xaringanExtra::use_clipboard()
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         
  mute_unhighlighted_code = TRUE  
)
library(flipbookr)
library(patchwork)
library(DT)
library(knitr)
library(grid)
library(gridExtra)


select <- dplyr::select

# Set ggplot theme
theme_set(theme_tufte(base_size = 10))

yt <- 0

# read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/agstrat.csv")
```


```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```


layout: true
  
---

class: title-slide, middle

# .fancy[Regression Revisited]

### .fancy[Stat 120]

`r format(Sys.Date(), ' %B %d %Y')`


---

class: middle

# Conducting a Linear Regression Test

.bqt.font90[
## .bold[Step 1: Stating the Hypotheses]

- Null Hypothesis $(H_0)$: There is no linear relationship between the predictor and response variables. Mathematically, $H_0: \beta_1 = 0$.
- Alternative Hypothesis $(H_1)$: There is a linear relationship between the predictor and response variables. Mathematically, $H_1: \beta_1 \neq 0$.
]

---

class: middle

# Conducting a Linear Regression Test

.bqt.font90[
## .bold[Step 2: Checking Conditions]

1. **Linearity:** The relationship between the predictor and response variable should be linear.
2. **Independence:** Observations are independent of each other.
3. **Homoscedasticity:** Constant variance of error terms.
4. **Normality:** The residuals of the model should be approximately normally distributed.
]

---

class: middle

# Conducting a Linear Regression Test


.bql.font90[
## .bold[Step 3: Calculating the t-Statistic]

The t-statistic is calculated using the formula:

$$ t = \frac{\hat{\beta}_1 - 0}{SE(\hat{\beta}_1)} $$

- $\hat{\beta}_1$ is the estimated slope coefficient.
- $SE(\hat{\beta}_1)$ is the standard error of the estimated slope.
]

.hljs[This statistic helps us determine if the observed relationship between the variables is statistically significant.]


---

class: middle

# Conducting a Linear Regression Test


.bq.font80[
## .bold[Step 4: Calculating the p-Value]

- The p-value is obtained from the t-distribution with $n - 2$ degrees of freedom, where $n$ is the number of observations.
- It indicates the probability of observing a t-statistic as extreme as, or more extreme than, the one calculated from the sample data, under the assumption that the null hypothesis is true.
]

---

class: middle

# Conducting a Linear Regression Test



.bqt.font80[
## .bold[Step 5: Drawing Conclusions]

- **If p-value < $\alpha$:** Reject $H_0$. There is sufficient evidence to conclude there is a significant linear relationship between the predictor and response variable.
- **If p-value > $\alpha$:** Fail to reject $H_0$. There is not enough evidence to conclude there is a significant linear relationship.
]

---

class: middle

## Confidence Interval for the Slope

.bqt.font90[
- A 95% confidence interval for the slope $(\beta_1)$ can be calculated as:

$$ CI: \hat{\beta}_1 \pm t^* \cdot SE(\hat{\beta}_1) $$

- $t^*$ is the threshold from the t-distribution for a given confidence level.
]


.hljs[
### .bold[Interpreting the Confidence Interval]

- If the confidence interval for $\beta_1$ does not include 0, it supports the conclusion that there is a significant linear relationship.
- The confidence interval provides a range of plausible values for the slope, giving insight into the strength and direction of the relationship.
]

---

class: middle

# Case Study

.pull-left[
.bql[
.b[Objective:]
Learn to conduct linear regression analysis, focusing on GPA as a response to studying mathematics.

.b[Dataset:]
School score data comprising GPA and average years spent studying mathematics.
]
]


.pull-right[
.b[Tools:]

- R for data analysis
- `ggplot2` for data visualization
- Base R plots for diagnostic checks
]

---


class: action

# <i class="fa fa-pencil-square-o" style="font-size:48px;color:purple">&nbsp;Your&nbsp;Turn&nbsp;`r (yt <- yt + 1)`</i>    

.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[

<br>
<br>

.bql[
- Go over to the in-class activity file
- Let's do a case study together as a class
]
]

`r countdown(minutes = 40, seconds = 00, top = 0 , color_background = "inherit", padding = "3px 4px", font_size = "2em")`


---

class: middle

# Step 1: Load and Inspect Data


```{r}
# load school_scores.csv from your data directory
school_scores <- readr::read_csv("data/school_scores.csv")
# View the structure of the dataset
dplyr::glimpse(school_scores)
```


---

class: middle

# Step 2: Data Cleaning

.pull-left[
Cleaning Tasks:

- Standardize column names
- Remove rows with missing values
]

.pull-right[

```{r}
school_scores_clean <- school_scores %>%
  janitor::clean_names() %>%
  tidyr::drop_na()
```

]

---

class: middle

# Step 3: Data Manipulation

```{r}
school_final <- school_scores_clean %>%
  dplyr::select(academic_subjects_mathematics_average_gpa, state_name,
                academic_subjects_mathematics_average_years, total_math
                ) %>%
mutate(GPA_category = cut(academic_subjects_mathematics_average_gpa,
                            breaks = c(-Inf, 3.25, 3.5, Inf),
                            labels = c("Low", "Good", "Excellent")))
```


---


.panelset[

.panel[.panel-name[Step 4: Exploratory Data Analysis (EDA)]
```{r, echo=FALSE, out.width="70%", fig.width=7, fig.height=4, fig.align='center'}
ggplot(data = school_final, aes(x = academic_subjects_mathematics_average_years, 
                                y = academic_subjects_mathematics_average_gpa)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(x = "Study Years", y = "GPA")

```
]


.panel[.panel-name[Code]
```{r, eval=FALSE}
ggplot(data = school_final, aes(x = academic_subjects_mathematics_average_years, 
                                y = academic_subjects_mathematics_average_gpa)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(x = "Study Years", y = "GPA")

```
]


]


---

class: middle

## Step 5: Linear Regression Model

.font40[
```{r}
GPA.lm <- lm(academic_subjects_mathematics_average_gpa ~ 
               academic_subjects_mathematics_average_years, 
             data = school_final)
summary(GPA.lm)
```
]


---

class: middle

## Step 6: Diagnostic Plots: Residual Plot





```{r, echo=FALSE, out.width="90%", fig.width=7, fig.height=4, fig.align='center'}
plot(GPA.lm, which = 1) # Residual Plot
```


---

class: middle

## Step 6: Diagnostic Plots: QQ Plot



```{r, echo=FALSE, out.width="90%", fig.width=7, fig.height=4, fig.align='center'}
plot(GPA.lm, which = 2) # QQ Plot
```



---

class: middle

# Step 7: Hypothesis Testing for Slope

.hljs[
$H_0: \beta_1 = 0$ (No relationship)
$H_1: \beta_1 \neq 0$ (A relationship exists)
]

.bql[
Hypothesis tests for the slope follow the formula:

$$t=\frac{b_1-\text { null slope }}{S E}$$ 
]

```{r}
slope_estimate <- coef(GPA.lm)["academic_subjects_mathematics_average_years"]
slope_std_error <- summary(GPA.lm)$coefficients["academic_subjects_mathematics_average_years", "Std. Error"]
t_value <- (slope_estimate- 0) / slope_std_error
p_value <- 2 * pt(-abs(t_value), df = summary(GPA.lm)$df[2])
```

.pull-left[

```{r, collapse=TRUE}
t_value
```

]
.pull-right[
```{r, collapse=TRUE}
p_value
```

]

---


class: middle

# Step 8: CI for Slope

.hljs[
$H_0: \beta_1 = 0$ (No relationship)
$H_1: \beta_1 \neq 0$ (A relationship exists)
]

.bql[
Confidence intervals for the slope follow the formula:

$$b_1 \pm t^* \cdot S E$$
where $b_1$ is the slope estimate, $SE(b_1)$ is the standard error of the slope, and $t^*$ is the threshold from the t-distribution.

]

```{r}
conf_interval <- confint(GPA.lm, "academic_subjects_mathematics_average_years", level = 0.95)
conf_interval
```


---

class: middle

# Step 9: Handling Outliers


```{r, echo=FALSE, out.width="70%", fig.width=7, fig.height=4, fig.align='center'}
school_selected <- school_final %>% 
  filter(state_name %in% c("Alabama", "California", "Montana", "Minnesota", "Nevada"))

ggplot(school_selected, aes(x=GPA_category, y=total_math, fill=GPA_category)) +
  theme_bw() +
  geom_boxplot() +
  geom_jitter(width = 0.2) +
  labs(title="Boxplot of Math SAT Across GPA Categories",
       y="Average Math Score", x="GPA") +
  stat_summary(fun=mean, geom="point", shape=10, size=2, color="red", fill="black")

```

.hljs[
Visual inspection using boxplots helps in spotting outliers within these categories.
]

---

class: middle

# Step 10: Removing Outliers

```{r, echo=FALSE, out.width="70%", fig.width=7, fig.height=4, fig.align='center'}
school_selected_no_outlier <- school_selected %>%
  filter(GPA_category == "Excellent" & total_math >= 575 & total_math <= 800 |
         GPA_category == "Good" & total_math >= 525 & total_math <= 575 |
         GPA_category == "Low" & total_math >= 425 & total_math <= 525)

school_selected_no_outlier %>%
  ggplot(aes(x=GPA_category, y=total_math, fill=GPA_category)) +
  theme_bw() +
  geom_boxplot() +
  geom_jitter(width = 0.2) +
  labs(title="Boxplot of Math SAT Across GPA Categories",
       y="Average Math Score", x="GPA") +
  stat_summary(fun=mean, geom="point", shape=10, size=2, color="red", fill="black")
```


.hljs[With outliers removed, we re-visualize the math SAT scores across GPA categories to better understand the data distribution.]



