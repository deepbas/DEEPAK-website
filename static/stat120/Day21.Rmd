---
title: "Inference for two means"
subtitle: "<br/> STAT 120"
author: "Bastola"
date: "`r format(Sys.Date(), ' %B %d %Y')`"
output:
  xaringan::moon_reader:
    css: ["default", css/xaringan-themer-solns.css, css/my-theme.css, css/my-font.css]
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    seal: false
    nature:
      highlightStyle: googlecode  #http://arm.rbind.io/slides/xaringan.html#77 # idea, magula
      highlightLines: true
      highlightLanguage: ["r", "css", "yaml"]
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
      titleSlideClass: ["left", "middle", "inverse"]
      ratio: "16:9"
    includes:
      in_header: header.html
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
options(htmltools.preserve.raw = FALSE)
options(ggrepel.max.overlaps = Inf)

knitr::opts_chunk$set(echo = TRUE, 
                      dev = 'svg',
                      collapse = FALSE, 
                      comment = NA,  # PRINTS IN FRONT OF OUTPUT, default is '##' which comments out output
                      prompt = FALSE, # IF TRUE adds a > before each code input
                      warning = FALSE, 
                      message = FALSE,
                      fig.height = 3, 
                      fig.width = 4,
                      out.width = "100%"
                      )

# load necessary packages
library(tidyverse)
library(dplyr)
library(countdown)
library(ggthemes)
library(xaringanExtra)
library(forcats)
xaringanExtra::use_panelset()
xaringanExtra::use_tachyons()
xaringanExtra::use_clipboard()
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         
  mute_unhighlighted_code = TRUE  
)
library(flipbookr)
library(patchwork)
library(DT)
library(knitr)
library(grid)
library(gridExtra)


select <- dplyr::select

# Set ggplot theme
theme_set(theme_tufte(base_size = 10))

yt <- 0

set.seed(1234)

# read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/agstrat.csv")

```


```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```


layout: true
  
---

class: title-slide, middle

# .fancy[Inference for two means]

### .fancy[Stat 120]

`r format(Sys.Date(), ' %B %d %Y')`

---

class: middle

# The SE for means

.bql.font80[
- The standard error for $\bar{x}$ is
$$S E_{\bar{x}}=\frac{\sigma}{\sqrt{n}}$$
where $\sigma$ is the population SD of your response

- The standard error for $\bar{x}_{1}-\bar{x}_{2}$ is
$$S E_{\bar{x}_{1}-\bar{x}_{2}}=\sqrt{\frac{\sigma_{1}^{2}}{n_{1}}+\frac{\sigma_{2}^{2}}{n_{2}}}$$

.b[
But we usually do not know $\sigma$ !

  - Estimate $\sigma$ with the sample SD $s$

]
]


---

class: middle

# Central Limit Theorem for means: One sample

.hljs[
The sampling distribution for a sample mean, $\bar{x}$, is approximately $N\left(\mu, S E_{\bar{x}}\right)$
]

<br>

.bql[
When is this approximately "good"?

- if $X \sim N(\mu, \sigma)$ then $\bar{X} \sim N(\mu, \sigma / \sqrt{n})$

- if $X \nsim N(\mu, \sigma)$ then $\bar{X} \sim N(\mu, \sigma / \sqrt{n})$ if $n \geqslant 30$
]


---

class: middle

# Central Limit Theorem for means: Two independent samples:

.hljs[
The sampling distribution for a difference of two independent sample means is approximately $N\left(\mu_{1}-\mu_{2}, S E_{\bar{x}_{1}-\bar{x}_{2}}\right)$
]

<br>

.bql[
When is this approximately "good"?
- need both $n_{1}$ and $n_{2}$ samples sizes big enough for the one-sample condition
]


---

class: middle

# Academic Performance Index (API) 

.hljs[
Academic Performance Index (API) is a number reflecting a schoolâ€™s performance on a statewide standardized test
  - simple random sample of $n=200$ schools
  - variable `growth` measures the growth in API from 1999 to 2000 (API 2000 - API 1999).
]

```{r}
# read data
api <- read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/API.csv")
```

---

class: middle

# Academic Performance Index (API) 

.code100[
```{r, collapse=TRUE}
api$wealth <- ifelse(api$meals > 50, "low","high")
table(api$wealth)
```
]

.code100[
```{r, collapse=TRUE}
library(dplyr)
api %>% 
  group_by(wealth) %>% 
  summarize(mean = mean(growth), 
            sd = sd(growth))
```
]

---

# API

```{r, fig.width=5, fig.height=4, out.width="50%", fig.align='center'}
ggplot(api, aes(x = growth, y = wealth)) + geom_boxplot() + 
  labs(y ="API growth (2000 - 1999)") 
```


---

## Hypothesis Test: Can we use t-inference methods to compare mean growths?

.hljs[
- Both samples sizes (98 and 102) can be deemed large 
- No severe skewness (but two extreme outliers)
]

.bql.font80[
- Estimated Standard Error : $SE_{\bar{x}_h - \bar{x}_l} = \sqrt{\dfrac{28.75380^2}{102} + \dfrac{29.95048^2}{98}} = 4.1544$

- Test statistics: $t = \dfrac{(25.24510 - 38.82653) - 0}{4.154404} = -3.2692$
]

..hljs[The observed mean difference is 3.3 SEs below the hypothesized mean difference of 0]

---

# Two-sample t-test

```{r, highlight.output = c(5)}
t.test(growth ~ wealth, data = api) 
```

.font80[
> The p-value is 0.001273. If there is no difference between mean growth in the two populations,
then there is just a 0.13% chance of seeing a sample mean difference that is 3.27 standard errors or more
away from 0.
]

---

# Outliers

```{r, collapse=TRUE}
which(api$growth > 120 )
```


```{r, collapse=TRUE}
library(dplyr)
api %>% slice(74,119)  # slice the corresponding rows from the dataset #<<
```

---

# `t.test` with outliers removed

```{r, highlight.output = c(5)}
t.test(growth ~ wealth, data = api, subset = -c(74,119)) #<<
```

--

..hljs[How does removing outliers influence `t-test` stat and p-value?]


---

# Confidence Interval

.pull-left[
.bql.font90[

.hljs[
.bolder[95% Confidence Interval from the output:]
- Without Outliers: (-23.57, -8.96)
- With Outliers: (-21.77, -5.39)
]
]
]

.pull-right[
.bql.font80[
.bolder[Removing Outliers:]
- the difference in means shifted further away from 0
- CI shifted further from a difference of 0
- decrease the SE of our sample difference
]
]

--

<br>

.bq.font90[
.bold[Interpretation:] We are 95% confident that the mean API growth between 1999 and 2000 for all low wealth
schools is anywhere from 8.96 points to 23.57 points higher than the mean API growth for all high wealth
schools in California.
]

---

## Paired Data

.bql.font90[Data are paired if the data being compared consists of paired data values. Common paired data examples:
  - Two measurements on each case
  - natural pairs (twins, spouses, etc)
]

--

<br>

.bq.font80[Use paired data to reduce natural variation in the response when comparing the two groups/treatments
  - comparing group 1 and 2 responses among similar individuals 
  - reduces the effects of confounding variables
  - reduces the SE for the mean difference!
]

---

class: middle

# Analyzing paired data

.bql.font80[
- Look at the difference between responses for each unit (pair)
$$d_{i} = x_{1,i} - x_{2,i}$$

- Analyze the .bold[mean of these differences] rather than the average difference between two groups
$$\textrm{sample mean difference: } \bar{d}$$
$$\textrm{sample SD of difference: } s_d$$
$$\textrm{population mean difference: } \mu_d$$

- Use .bold[one sample] inference methods for these differences
]

---

# Tuition example

.bql.font90[How much higher is non-resident tuition, on average, compared to resident tuition? Use the `Tuition2006.csv` lab manual data
  - the variable `Diff` computes the difference `Res` - `NonRes`
]
    
```{r, collapse=TRUE, highlight.output = 6}
tuition <- read.csv("http://math.carleton.edu/Stats215/RLabManual/Tuition2006.csv")
str(tuition)
```


---

## Tuition example: Histogram and QQ-plot



.pull-left[
```{r}
ggplot(tuition, aes(x = Diff)) +
  geom_histogram(fill = "steelblue", bins = 5,
                 col = "lightblue") +
  labs(title = "Histogram")
```
]
.pull-right[
```{r}
ggplot(tuition, aes(sample = Diff)) +
  stat_qq() +
  stat_qq_line()+
  labs(title = "Q-Q Plot")
```
]

---

## Tuition example: `t-test`

.pull-left[
```{r, collapse=TRUE}
t.test(tuition$Diff)
```
]

.pull-right[
```{r, collapse=TRUE}
# alternate method
t.test(tuition$Res, tuition$NonRes, paired = TRUE)
```

]

.bq.font90[

We are 95% confident that the mean tuition for non-residents is `r paste0("$", 2585)` to `r paste0("$", 4584)` higher than mean tuition for residents

]

---

class: action

# <i class="fa fa-pencil-square-o" style="font-size:48px;color:purple">&nbsp;Your&nbsp;Turn&nbsp;`r (yt <- yt + 1)`</i>    


.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[

<br>
.bql[
- Let's go over to the [course helper page](https://stat120-winter24.netlify.app/)
- Please do the class activity and let me know if you have any questions
- Feel free to talk to your neighbor
]
]

`r countdown(minutes = 25, seconds = 00, top = 0 , color_background = "inherit", padding = "3px 4px", font_size = "2em")`

