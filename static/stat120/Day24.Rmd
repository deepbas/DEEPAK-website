---
title: "Comparing Two or more Means"
subtitle: "<br/> STAT 120"
author: "Bastola"
date: "`r format(Sys.Date(), ' %B %d %Y')`"
output:
  xaringan::moon_reader:
    css: ["default", css/xaringan-themer-solns.css, css/my-theme.css, css/my-font.css]
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    seal: false
    nature:
      highlightStyle: googlecode  #http://arm.rbind.io/slides/xaringan.html#77 # idea, magula
      highlightLines: true
      highlightLanguage: ["r", "css", "yaml"]
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
      titleSlideClass: ["left", "middle", "inverse"]
      ratio: "16:9"
    includes:
      in_header: header.html
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
options(htmltools.preserve.raw = FALSE)
options(ggrepel.max.overlaps = Inf)

knitr::opts_chunk$set(echo = TRUE, 
                      dev = 'svg',
                      collapse = FALSE, 
                      comment = NA,  # PRINTS IN FRONT OF OUTPUT, default is '##' which comments out output
                      prompt = FALSE, # IF TRUE adds a > before each code input
                      warning = FALSE, 
                      message = FALSE,
                      fig.height = 3, 
                      fig.width = 4,
                      out.width = "100%"
                      )

# load necessary packages
library(tidyverse)
library(dplyr)
library(countdown)
library(ggthemes)
library(xaringanExtra)
library(forcats)
xaringanExtra::use_panelset()
xaringanExtra::use_tachyons()
xaringanExtra::use_clipboard()
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         
  mute_unhighlighted_code = TRUE  
)
library(flipbookr)
library(patchwork)
library(DT)
library(knitr)
library(grid)
library(gridExtra)


select <- dplyr::select

# Set ggplot theme
theme_set(theme_tufte(base_size = 10))

yt <- 0

set.seed(1234)



# read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/agstrat.csv")

```


```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```


layout: true
  
---

class: title-slide, middle

# .fancy[Comparing Two or more Means]

### .fancy[Stat 120]

`r format(Sys.Date(), ' %B %d %Y')`

---

class: middle

# Inference tools (Classical methods)

.pull-left[
.bq.font80[
Categorical Response

1. One proportion: .blue[sample z test/CI]

2. Difference in 2 props: .blue[2 sample z test/CI OR chi-square test]

3. Association between 2 categorical variables: .blue[chi-square test]
]
]
.pull-right[
.bq.font80[
Quantitative Response

1. One mean: .blue[1 sample t test/CI]
  
2. Difference in 2 means: .blue[2 independent sample t test/CI OR Matched pairs]
  
3. Compare >2 means: .b[One-way ANOVA]
  <br>

]
]

---

class: middle

# Multiple Categories

.bqt[
So far, we’ve learned how to do inference for a difference in means IF the categorical variable has .bold[only two categories (i.e. compare two groups)]
]
<br>

.bqt[
In this section, we’ll learn how to do hypothesis tests for a difference in means .bold[across multiple categories (i.e. compare more than two groups)]
]

---

class: middle

# Hypotheses

.bql[To test for a difference in true/population means across k groups:

\begin{align*}
H_{0}:& \quad \mu_{1}=\mu_{2}=\ldots=\mu_{k}\\
H_{a}:& \quad \text{At least one } \mu_{i} \neq \mu_{j}
\end{align*}


]

---

# Frisbee Example 

.out-t[Does Frisbee grip affect the distance of a throw?]

.hljs.font80[A student performed the following experiment: 3 grips, 8 throws using each grip
    1. Normal grip
    2. One finger out grip
    3. Frisbee inverted grip]


.bql.font80[A grip type is randomly assigned to each of the 24 throws she plans on making

  - Response: measured in paces how far her throw went
  - Question: How might you summarize her data?
]

---

class: middle

# Frisbee Example

.pull-left[
<center>
<img src="images/frisbee.png" width="80%" height="80%"> <br>
</center>
]
.pull-right[
<br>
<br>

&nbsp; | Finger-out | Inverted   | Normal
-------- | ------------- | ----------- | -----------
n | 8  |  8   |   8  
Mean |  29.5  | 32.375    | 33.125
SD |  4.175 | 3.159  |  3.944

]

.bql.font90[
Question: Is this evidence that grip affects mean distance thrown? 
\begin{align*}
H_{0}:& \quad \mu_{1}=\mu_{2}=\mu_{3}\\
H_{a}:& \quad \text{At least one } \mu_{1}, \mu_{2}, \mu_{3} \text{ is not the same}
\end{align*}
]

---

class: middle

# Why Analyze Variability to Test for a Difference in Means?

.pull-left-40[

.bql.font80[
- The group means in Datasets $A$ and $B$ are the same, but the boxes show different spread.

- Datasets $A$ and $C$ have the same spread for the boxes, but different group means.
]
]
.pull-right-60[
<center>
<img src="images/anova-plot.png" width="90%" height="90%"> <br>
</center>
.hljs[Which of these graphs appear to give strong visual evidence for a difference in the group means?]
]

---

class: middle

# Why Analyze Variability to Test for a Difference in Means?

.pull-left-40[

.bql.font90[
- Dataset A = weakest evidence for a difference in means.
- Datasets B and C = strong evidence for a difference in means.
]
]
.pull-right-60[

<center>
<img src="images/anova-plot.png" width="90%" height="90%"> <br>
</center>

]

---

class: middle

# Why Analyze Variability to Test for a Difference in Means?

.pull-left-40[

.bql.font90[
.b[Conclusion:] An assessment of the difference in means between several groups depends on two kinds of variability:
1. How different the means are between each groups
2. The amount of variability within each groups
]
]
.pull-right-60[
<br>
<center>
<img src="images/anova-plot.png" width="90%" height="90%"> <br>
</center>
]

---

# Analysis of Variance

.hljs[
Analysis of Variance (ANOVA) compares the variability between groups to the variability within groups
]

<center>
<img src="images/ANOVA-decomposition.png" width="90%" height="80%"> 
</center>

---

class: middle

# F-Statistic

.bql.font90[
The F-statistic is a ratio:
$$F=\frac{M S G}{M S E}=\frac{\text { average between group variability }}{\text { average within group variability }}$$

]

.hljs[If there really is a difference between the groups $(H_A \text{ true})$, we would expect the F-statistic to be

a) Large positive

b) Large negative

c) Close to 0
]

<details>
<summary>.red[Click for answer]</summary>
.hljs[
The correct answer is a. If there is a difference, we expect the between group variability to be higher than within group variability. .red[RIGHT TAIL test!]]
</details>

---

class: middle

# Frisbee Example

```{r}
frisbee <- read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/Frisbee.csv")
frisbee.anova <- aov(Distance ~ Grip, data = frisbee) # fit an ANOVA model
```



```{r, highlight.output = c(2), collapse=TRUE}
summary(frisbee.anova)
```

.hljs[
F-test statistic: 2.045

P-value: 0.154
]

---

<br>
<br>

# How to determine significance?

.out-t[We have a test statistic. What else do we need to perform the hypothesis test?]

--

.hljs[
A distribution of the test statistic assuming $H_0$ is true.
]

--

.bql[
How do we get this? Two options:
  1. Simulation
  2. Theory
]

---


class: middle

# F-Distribution

.bql.font90[
We can use the F-distribution to generate a p-value if:

  1. Sample sizes in .b[each group] are large (each $n_{i} \geq 30$ ) OR the data within each group are relatively normally distributed
  2. Variability is .b[similar] in all groups
]
<br>
.hljs[
- The F-distribution has two degrees of freedom, one for the numerator of the ratio $(\boldsymbol{k}-\mathbf{1})$ and one for the denominator $(n-k)$
- For F-statistics, the p-value (the area as extreme or more extreme) is always the right tail

]

---

class: middle

# F-distribution


.pull-left-60[
<center>
<img src="images/rand-frisbee-pvalue.png" width="100%" height="100%"> 
</center>
]
.pull-right-40[

.bql.font80[
- An F-statistic as large as 2.045 would occur by chance about 16% of the time if the means were all equal.
- Our results are inconclusive and do not support the claim that grips affects average distance.
]

```{r, collapse=TRUE}
1 - pf(2.045,2,21)  # p-value
```

]


---

class: middle


# Check assumptions: large sample size (or normality)

.pull-left-40[
<center>
<img src="images/frisbee.png" width="80%" height="80%"> 
</center>

```{r, collapse=TRUE}
table(frisbee$Grip)  # check n's
```

.hljs[
Small $n_i$ but all groups are roughly normal
]

]

.pull-right[

```{r}
# checking normality with qq-plots
ggplot(frisbee, aes(sample = Distance)) + 
  geom_qq() + geom_qq_line() +  facet_wrap(~Grip) +  
  theme(axis.text.x = element_text(size = 4))
```

]

---

class: middle


# Check Assumptions: Equal Variance

.bql[
The F-distribution assumes equal within group variability for each group. This is also an assumption when using the .b[randomization distribution].

- As a rough .bold[rule of thumb], this assumption is violated if the largest group standard deviation is more than double the smallest group standard deviation
]

.pull-left[
```{r}
tapply(frisbee$Distance, frisbee$Grip, sd)
```
]
.pull-right[Check if:
$$\frac{\text{largest }s}{\text{smallest }s} > 2$$
]

---

class: middle


# Frisbee Example: Inference

.hljs[
.bold[Question:] Is this evidence that grip affects mean distance thrown? 
\begin{align*}
H_{0}:& \quad \mu_{1}=\mu_{2}=\mu_{3}\\
H_{a}:& \quad \text{At least one } \mu_{1}, \mu_{2}, \mu_{3} \text{ is not the same}
\end{align*}
$\mu_{\mathrm{i}}$ is the true mean distance thrown using grip $i$.
$$F=2.05(\mathrm{df}=2,21), \text { P-value }=0.1543$$
]




.bq.font90[
.b[Conclusion:] Do not reject the Null hypothesis. The difference in observed means is not statistically significant.

About 15% of the time we would see the grip differences like those observed, or even bigger, when there is actually no difference between the true mean distances thrown with different grips.
]

---

class: middle


# Picturing the variation
.pull-left[
.left.green[Green: Variation within groups] ]

.pull-right[
.right.blue[Blue: Variation between groups]
]
<center>
<img src="images/anova-picture.png" width="70%" height="70%"> <br>
</center>


---

class: middle


# ANOVA Table for Frisbee data

$$\text{F test stat} = 29.29/14.32 = 2.045$$
<br>

Source | df | Sum of Squares   | Mean Square
-------- | ------------- | ----------- | -----------
Groups <br> &nbsp; | #groups -1 <br> .red.b[3-1 = 2]|  SSG <br> .red.b[58.583]  |   SSG/df <br> .red.b[58.583/2 = 29.29]
Error <br> (residual) | n - #groups <br> .red.b[24-3 = 21]  | SSE <br>  .red.b[300.750] | SSE/df <br> .red.b[300.75/21= 14.32]
Total |  n-1 <br> .red.b[24-1 = 23] | SSTotal <br> .red.b[359.333]  |  &nbsp;


---

class: middle

# ANOVA Table formula (.b[don't memorize!])


<table>
<tr>
    <th>Source</th>
    <th>df</th>
    <th>Sum of Squares</th>
    <th>Mean Square</th>
</tr>
<tr>
    <td>Groups</td>
    <td>\( k - 1 \)</td>
    <td>\( \sum_{\text{groups}} n_i (\bar{x}_i - \bar{x})^2 \)</td>
    <td>\( \frac{SSG}{k - 1} \)</td>
</tr>
<tr>
    <td>Error (residual)</td>
    <td>\( N - k \)</td>
    <td>\( \sum_{\text{groups}} (n_i - 1) s_i^2 \)</td>
    <td>\( \frac{SSE}{N - k} \)</td>
</tr>
<tr>
    <td>Total</td>
    <td>\( N - 1 \)</td>
    <td>\( \sum_{\text{values}} (x_i - \bar{x})^2 \)</td>
    <td></td>
</tr>
</table>



---

# Frisbee Example: ANOVA table in R


```{r}
frisbee.anova <- aov(Distance ~ Grip, data = frisbee)
```

```{r, collapse=TRUE}
summary(frisbee.anova)
```


```{r}
library(broom) 
knitr::kable(tidy(frisbee.anova)) # nicer summary tables
```

---

class: action

# <i class="fa fa-pencil-square-o" style="font-size:48px;color:purple">&nbsp;Your&nbsp;Turn&nbsp;`r (yt <- yt + 1)`</i>    


.pull-left-40[
![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)
]
.pull-right-60[

<br>
.bql[
- Let's go over to the [course helper page](https://stat120-fall23.netlify.app/)
- Please do the class activity and let me know if you have any questions
- Feel free to talk to your neighbor
]
]
]

`r countdown(minutes = 10, seconds = 00, top = 0 , color_background = "inherit", padding = "3px 4px", font_size = "2em")`
