---
title: "More on Linear Regression"
subtitle: "<br/> STAT 120"
author: "Bastola"
date: "`r format(Sys.Date(), ' %B %d %Y')`"
output:
  xaringan::moon_reader:
    css: ["default", css/xaringan-themer-solns.css, css/my-theme.css, css/my-font.css]
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    seal: false
    nature:
      highlightStyle: googlecode  #http://arm.rbind.io/slides/xaringan.html#77 # idea, magula
      highlightLines: true
      highlightLanguage: ["r", "css", "yaml"]
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
      titleSlideClass: ["left", "middle", "inverse"]
      ratio: "16:9"
    includes:
      in_header: header.html
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
options(htmltools.preserve.raw = FALSE)
options(ggrepel.max.overlaps = Inf)

knitr::opts_chunk$set(echo = TRUE, 
                      dev = 'svg', 
                      collapse = FALSE, 
                      comment = NA,  # PRINTS IN FRONT OF OUTPUT, default is '##' which comments out output
                      prompt = FALSE, # IF TRUE adds a > before each code input
                      warning = FALSE, 
                      message = FALSE,
                      fig.height = 3, 
                      fig.width = 4,
                      out.width = "100%"
                      )

# load necessary packages
library(tidyverse)
library(dplyr)
library(countdown)
library(ggthemes)
library(xaringanExtra)
library(forcats)
xaringanExtra::use_panelset()
xaringanExtra::use_tachyons()
xaringanExtra::use_clipboard()
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         
  mute_unhighlighted_code = TRUE  
)
library(flipbookr)
library(patchwork)
library(DT)
library(knitr)
library(grid)
library(gridExtra)
library(tikzDevice)


select <- dplyr::select

# Set ggplot theme
theme_set(theme_tufte(base_size = 10))

yt <- 0

# read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/agstrat.csv")
```


```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```


layout: true
  
---

class: title-slide, middle

# .fancy[More on Linear Regression]

### .fancy[Stat 120]

`r format(Sys.Date(), ' %B %d %Y')`

---


# Simple Linear Regression: Linear Regression of BAC (y) on Beers (x)

.hljs.font90[
\begin{align*}
\hat{\mu}(B A C \mid X) &=-0.0127+0.0180(\text { Beers })\\
\hat{\sigma} &= 0.02044
\end{align*}
]

```{r, echo=FALSE}
# residual size plot
library(ggplot2)
bac <- read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/BAC.csv")
bac.lm <- lm(BAC ~ Beers, data = bac) # fit the model
summary(bac.lm)
```

---


class: middle

# Confidence Interval

.bql[
C% confidence interval for $\beta_i$ is $\hat{\beta}_i \pm t^* \operatorname{SE}\left(\hat{\beta}_i\right)$

- Get CIs for slope/intercept with `confint` command or compute using `qt(.975, df= )` to get t* for 95% CI
]


```{r, collapse=TRUE}
confint(bac.lm)  # 95% C.I. 
```



---

class: middle

# Inference for slope (effect of Beers on BAC)

.hljs[
\begin{align*}
\mathrm{H}_0: &\beta_i=0 & \text { (no effect for predictor } \mathrm{i} \text { ) } \\
\mathrm{H}_A: &\beta_i \neq 0 & \text { (predictor i has an effect on } \mathrm{y} \text { ) }
\end{align*}
]


```{r, echo=FALSE}
library(broom)
knitr::kable(tidy(bac.lm))
```


---

## Inference for slope (effect of Beers on BAC)

.hljs[
95% CI for true slope (effect on the mean):

```{r}
bac <- read.csv("https://raw.githubusercontent.com/deepbas/statdatasets/main/BAC.csv")
bac.lm <- lm(BAC ~ Beers, data = bac) # fit the model
knitr::kable(confint(bac.lm)) # confidence interval
```

$$0.018 \pm 2.1448(0.0024)=(0.013,0.023)$$
]

.b[Each additional beer is associated with an average increase in BAC of 0.018 (95% CI 0.013 to 0.023).]

---

class: middle

# Multiple regression: include more predictors (explanatory variables)

.bql[
Suppose you have $p$ explanatory variables

- Mean of $Y$ is a linear function of $\boldsymbol{x}_1, \boldsymbol{x}_2, \ldots, \boldsymbol{x}_p$ $\mu(Y \mid X)=\beta_0+\beta_1 X_1+\beta_2 X_2+\cdots+\beta_p X_p$

]

---

## Scatterplot matrix for BAC example

```{r, echo = TRUE, fig.align='center', fig.width=3.5, fig.height=3, out.width="50%"}
library(GGally)
ggpairs(bac[, -c(1,2,3)]) + theme(axis.text.x = element_text(size = 3))
```

---

# Regression of BAC on Beers and Weight

```{r, echo=FALSE}
lm1.bac <- lm(BAC ~ Beers + Weight, data = bac) # fit the model
summary(lm1.bac)
```


.b.font90[The fitted model for BAC is $$\widehat{B A C}=\hat{\mu}(B A C \mid X)=0.0399+0.0200 (Beers)-0.00036(Weight).$$ 
]

---


## Regression of BAC on Beers and Weight

```{r, echo=FALSE}
knitr::kable(tidy(lm1.bac))
knitr::kable(confint(lm1.bac))
```

.b[
Both number of beers and weight are statistically significant predictors of BAC (p-value $<0.0001$ ). Holding weight constant, we are $95 \%$ confident that the true effect of drinking one more beer is a $0.017$ to $0.23$ unit increase in mean $\mathrm{BAC}$.
]


---

# Scatterplot Matrix for BAC example

```{r, echo = FALSE, fig.align='center', fig.width=3.5, fig.height=3, out.width="60%"}
library(GGally)
ggpairs(bac[, -c(1,2)]) + theme(axis.text.x = element_text(size = 3))
```

---

# Regression of BAC on Beers, Weight and Gender

```{r, echo=FALSE}
lm2.bac <- lm(BAC ~ Beers + Weight + Gender, data = bac) # fit the model
```

```{r, eval=FALSE}
lm2.bac <- lm(BAC ~ Beers + Weight + Gender, data = bac) # fit the model
summary(lm2.bac)
```


```r
Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  3.871e-02  1.097e-02   3.528 0.004164 ** 
Beers        1.990e-02  1.309e-03  15.196 3.35e-09 ***
Weight      -3.444e-04  6.842e-05  -5.034 0.000292 ***
Gendermale  -3.240e-03  6.286e-03  -0.515 0.615584    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.01072 on 12 degrees of freedom
Multiple R-squared:  0.9528,	Adjusted R-squared:  0.941 
F-statistic: 80.81 on 3 and 12 DF,  p-value: 3.162e-08
```


.hljs[
The fitted model for $\mathrm{BAC}$ is
\begin{align*}
\widehat{B A C}=0.039+0.020(B e e r s)-0.00034(W e i g h t)-0.0032 \text { (Male) }
\end{align*}
]

---

class: middle

# Regression of BAC on Beers, Weight and Gender

$$\widehat{B A C}=0.039+0.020(B e e r s)-0.00034(W e i g h t)-0.0032 \text { (Male) }$$


.bq.font90[
"Male" is an indicator variable that equals 1 when we want to predict male $\mathrm{BAC}$ and 0 when we want to predict Female BAC.

(i) Barb drank 4 beers, weighs 160 lbs and is female:
\begin{align*}
\widehat{B A C}=0.039+0.020(4)-0.00034(160)-0.0032(0)=0.0646
\end{align*}
(i) John drank 4 beers, weighs 160 lbs and is male:
\begin{align*}
\widehat{B A C}=0.039+0.020(4)-0.00034(160)-0.0032(1)=0.0614
\end{align*}
]


.out-t[Holding weight and beers constant, we predict that the BAC of males is $0.0032$ units lower than females.
]

